__mjsload("h5",'\'use strict\';function d(){}function g(a,b,c){function f(){if(a){k(a,l);var e=(new Date).getTime(),Qb=e-T;l=b+(c-b)*(e-T)/cb.FADE_TIME;l=Math.min(100,l);l=Math.max(0,l);n++;d=.5*d+Qb/n*.5;Qb<cb.FADE_TIME?setTimeout(f,d):k(a,c)}}var l=b,e=cb.FADE_TIME/cb.FADE_FRAME_COUNT,d=e,T=(new Date).getTime(),n=0;setTimeout(f,e)}function k(a,b){for(var c=0;c<a.length;c++)a[c].setAlpha(b)}function m(a,b){if(this instanceof m)2==arguments.length?(this.x=a,this.y=b):this.y=this.x=0;else return new m(a,b)}function h(a){if(""===a.trim())return{};a=a.split("&");for(var b={},c=0,f=a.length;c<f;c++){var l=a[c].split("=");b[l[0]]=decodeURIComponent(l[1]||"")}return b}function x(a,b,c){var f=(a+b+c)/2;return Math.sqrt(Math.abs(f*(f-a)*(f-b)*(f-c)))}function u(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)+Math.pow(a.z-b.z,2))}function G(a,b){return a.x*b.x+a.y*b.y+a.z*b.z}function S(a,b,c,f){var l=u(a,b),e=u(a,c),d=u(a,f);a=u(b,c);c=u(c,f);f=u(f,b);b=x(l,e,a);e=x(e,d,c);l=x(d,f,l);a=x(a,c,f);return.02>Math.abs(b+e+l-a)}function O(a,b,c,f){c=(G(f,c)-G(f,a))/G(f,b);return 0<=c?{x:a.x+c*b.x,y:a.y+c*b.y,z:a.z+c*b.z}:null}function p(a,b,c,f){this.x=a||0;this.y=b||0;this.z=c||0;this.w=f||0}function t(){var a=document.createElement("img");a.style.position="absolute";a.style.zIndex=2;a.alt="loading...";a.src=Ia.blank;this.img=a}function P(a,b,c,f){this.x=a;this.y=b;this.width=c;this.height=f}function Q(a,b){this.cidx=a;this.ridx=b;this.bounds=new Ka(db*this.cidx,eb*this.ridx,db,eb);this.img=$b();var c=this.cidx,f=this.ridx,l=document.createElement("p");l.textContent=c+","+f;l.style.position="absolute";this.label=l;this.setViewSize(db,eb)}function $b(){var a=document.createElement("img");a.style.position="absolute";a.style.zIndex=1;a.alt="loading...";a.src=La.blank;a.onload=function(b){a.style.zIndex=3};return a}function J(){this._listeners={};this.maxListeners=20}function ca(a,b){this.pool=[];this.canvas=a;this.bindEvents=["touchstart","touchmove","touchend","mousedown","click"];this.bindEvent(b)}function ga(a){this.v=[];a?(this.v[0]=a[0],this.v[1]=a[1],this.v[2]=a[2],this.v[3]=a[3]):this.v[0]=this.v[1]=this.v[2]=this.v[3]=0}function e(a){a&&16==a.length?this.v=a:(this.v=[],this.identity())}function n(){ta.apply(this);this.vertices=[];this.indices=[];this.uvtData=[];this._modelMatrix=new Ra;this.texture=new Image;this.fixMatrix=[]}function r(a){this.canvas=a;this._2dContext=a.getContext("2d")}function y(a){Fb.apply(this);this.eventCoords=[];this._super=new Fb;this.build();this.addEventWatch();this.createLabel()}function W(a){Gb.apply(this);this._super=new Gb;Hb=a;this.build()}function U(a,b,c,f){this.projectMatrix=new Aa;this.viewMatrix=new Aa;this.up=this.target=this.eye=null;this.fovy=a;this.aspect=b;this.near=c;this.far=f;this.updateProjectMatrix()}function A(a){this.world=[];this.canvas=a;this.renderer=this.camera=null;this.viewPortMatrix=new Ba;this.coreMatrix=null;this.appParams={}}function ha(){this.subRects=[]}function V(a,b){this._lastSvid=null;this._isSvidChanged=!0;this._thumbs2=this._thumbs=this._tiles2=this._tiles=this._lastThumbs=this._currentThumbs=this._lastTiles=this._currentTiles=null;this._pano=a;b.style.overflow="hidden";this._createTiles(b);this._createThumbs(b);this._fadeAnimation=new Za}function L(a,b,c){Ib.apply(this);this.eventCoords=[];this._super=new Ib;this.build(a);b&&c&&this.rotateSelf(b/360*Math.PI*2,c);this._isStopRender=!1;this.manager=null}function R(a,b){return Math.sqrt(Math.pow(b.pageX-a.pageX,2)+Math.pow(b.pageY-a.pageY,2))}function Y(a,b,c){this._panoDom=a;this._startTouch={pageX:null,pageY:null,timeStamp:null};this._lastDragEvt=this._clickTimer=this._touch2=this._startTouch=null;this._listener={onClick:null,onDbClick:null,onDragStart:null,onDrag:null,onDragEnd:null};this._listener=b;!1!==c&&this.enable()}function da(a,b){this._panorama=a;this._canvas=b;this._scene3d=new ob(this._canvas);this._eventAction=qb.getInstance(this._canvas,a._sceneMask);this._initTarget=null;var c=a.getViewWidth(),f=a.getViewHeight();this._scene3d.setCamera(qa(c,f));this._initTarget=this._scene3d.camera.target;this.syncLookup();this._canvas.width=c;this._canvas.height=f;this._scene3d.viewPort(0,0,c,f);this._scene3d.setRenderer(new rb(this._canvas))}function qa(a,b){var c=new pb(100*Math.PI/180,a/b,.1,1e3),f=new Jb(0,0,0),l=new Jb(0,0,-1),e=new Jb(0,1,0);c.lookAt(f,l,e);return c}function B(a,b){Rb.apply(this);this._config=Object.create(sb);this._config._THUMB_URL=b.thumbDomain;this._config._TILE_SITES=b.tileDomain;this._ZoomFactor=null;this._fovy=b.fovy;this._viewWidth=b.viewWidth;this._viewHeight=b.viewHeight;this._svid=b.svid;this._heading=b.heading||0;this._pitch=b.pitch||0;this._zoom=b.zoom||1;this._tileZoom=1;this._topPitch=-90;this._bottomPitch=50;this._isPreLoad=b.preload;this._animationId=null;this._tileManager=new tb(this,a);this._resetZoomFactor(1)}function la(){return!1}function H(a,b){Sb.call(this);this._svid=null;this._pitch=this._heading=0;this._baseFovy=this._fovy=b.fovy;this._viewWidth=b.viewWidth;this._viewHeight=b.viewHeight;this._level=1;this._tileCount=Math.pow(2,this._level);this._tileWidth=256;this._containerDom=a;this._tileContainer=null;this._cubeSideDivs=[];this._thumbImgs=[];this._renderId=null;this._doRender=M.bindThis(this._doRender,this);this._onThumbLoaded=M.bindThis(this._onThumbLoaded,this);this._onTileImgLoaded=M.bindThis(ra,this);this._tileMgr=ub();this._buildTilesContainer();this.setViewPort(b.viewWidth,b.viewHeight)}function ra(a){a=a.target;a.style.transition="opacity 300ms ease-out";a.style.opacity=1;a=a.dataset;a=this._tileMgr.tileLoaded("i_"+a.x+"_"+a.y);1===a?this.dispatchEvent("tileLoaded"):0<a&&this.dispatchEvent("tileLoading",{percent:a})}function ua(a,b){0<b.length&&this.manager.renderTile(this.imgID)}function Ca(a,b,c){a=a._tileWidth/2*1*(a._level+1);a--;return 3>=b?"rotateY("+ -90*b+"deg) translateZ(-"+a+"px)":4==b?"rotateX(-90deg) translateZ(-"+a+"px)":"rotateX(90deg) translateZ(-"+a+"px)"}function q(a,b){Tb.apply(this);Ub.apply(this);this._containerDom=a;this._heading=this._svid=this._eventDetector=this._canvas=this._sceneMask=this._sceneContainer=this._panoContainer=null;this._pitch=0;this._minPitch=this.DEFAULT_MIN_PITCH;this._maxPitch=this.DEFAULT_MAX_PITCH;this._zoom=1;this._panoCore=null;this._baseFovy=b.fovy||fb.defaultFovY;Sa&&console.log("api options:",b);this._options={pf:b.pf,from:b.from,ch:b.ch,draggable:!1===b.draggable?!1:!0,canMove:!1===b.canMove?!1:!0,gyro:!1===b.gyro?!1:!0,hasLogo:!1===b.hasLogo?!1:!0,key:b.key||""};this.data={geoPos:{x:null,y:null},cameraHeight:2.3,cameraDir:0,address:null,scenicId:null};this._cachedData={};this._geoToWorldMatrix=new yb;this._viewWidth=a.clientWidth;this._viewHeight=a.clientHeight;this.stopOverlayChanged=!1;this.isOverlayVisible=!0;this.isForceRefresh=!1;this._model=null;this._onSvDataLoaded=$.bindThis(this._onSvDataLoaded,this);Kb.android&&(this.MAX_ZOOM=3);this._buildContainer();var c=Object.create(fb);if(b)for(var f in b)c[f]=b[f];b=c;b.fovy=this._baseFovy;b.viewWidth=this._viewWidth;b.viewHeight=this._viewHeight;Kb.supportsCSS3()&&"dom"!==b.renderer?this._panoCore=new vb(this._sceneContainer,b):(b.preload=Kb.isQQBrowser4(),this._panoCore=new wb(this._sceneContainer,b));this.setHeading(b.heading);this.setPitch(b.pitch);this.setZoom(b.zoom);b.svid&&this.setSvid(b.svid);this.markers={length:0,content:{}};var l=this;this.addListener("render",function(){l.refreshMarkersPosition()});b.svid&&this.setSvid(b.svid);this.scene=new xb(this,this._canvas);this._panoCore.get3DOverlays&&this.scene.addObject3D(this._panoCore.get3DOverlays());this.stopOverlayChanged=!1;this._initPanoListeners();Da(this,this._options)}function Da(a,b){b.draggable&&zb.create().addToPano(a);b.canMove&&Ab.create().addToPano(a);b.canMove&&Bb.create().addToPano(a)}function Ea(){var a=document.createElement("div"),b=a.style;b.position="absolute";b.width=0;b.height=0;return a}function ka(a,b){return function(){a.apply(b,arguments)}}function aa(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){a.apply(b,c)}}var C={TILE_WIDTH:256,TILE_HEIGHT:256,COL_COUNT:8,ROW_COUNT:4};C.TILES_WIDTH=C.TILE_WIDTH*C.COL_COUNT;C.TILES_HEIGHT=C.TILE_HEIGHT*C.ROW_COUNT;C.FADE_TIME=1e3;C.FADE_FRAME_COUNT=40;C.BEGIN_HEADING=180;C.debug=!1;var cb=C;d.prototype.fadeIn=function(a){g(a,0,100)};d.prototype.fadeOut=function(a){g(a,100,0)};var Z=window.navigator.userAgent,D={android:/android\\s(\\d+\\.\\d)/i.test(Z)?+RegExp.$1:0,ios:/iPad|iPod|iPhone/i.test(Z),iphone:/iPhone\\sOS\\s(\\d[_\\d]*)/i.test(Z)?+parseFloat(RegExp.$1.replace(/_/g,".")):0,ipad:/iPad.*OS\\s(\\d[_\\d]*)/i.test(Z)?+parseFloat(RegExp.$1.replace(/_/g,".")):0,ipod:/iPod\\sOS\\s(\\d[_\\d]*)/i.test(Z)?+parseFloat(RegExp.$1.replace(/_/g,".")):0,mqqBrowser:/MQQBrowser\\/(\\d+)/i.test(Z)?+parseFloat(RegExp.$1):0,uc:/UC/i.test(Z)||/UCWEB/i.test(window.navigator.vendor),micromessenger:/MicroMessenger/i.test(Z),i9300:/i9300/i.test(Z),sonyEricssonLT26i:/sonyEricssonLT26i/i.test(Z),google:/google/i.test(window.navigator.vendor),iosQQ:/(iPad|iPhone|iPod).*?QQ/g.test(Z),androidQQ:/\\bV1_AND_SQ_/.test(Z)};D.mobileQQ=D.iosQQ||D.androidQQ;D.mqq=D.mqqBrowser;D.isQQBrowser4=function(){return null!=navigator&&0<=navigator.userAgent.indexOf("MQQBrowser/4.0")};D.isQQBrowserCss=function(){return null==navigator||null!=navigator&&(-1!=navigator.userAgent.indexOf("MQQBrowser/1")||-1!=navigator.userAgent.indexOf("MQQBrowser/2")||-1!=navigator.userAgent.indexOf("MQQBrowser/3")||-1!=navigator.userAgent.indexOf("MQQBrowser/4")||-1!=navigator.userAgent.indexOf("MQQBrowser/5.0")||-1!=navigator.userAgent.indexOf("MQQBrowser/5.1")||-1!=navigator.userAgent.indexOf("MQQBrowser/5.2")||-1!=navigator.userAgent.indexOf("MQQBrowser/5.3"))};D.supportsCSS3=function(){return D.sonyEricssonLT26i||D.i9300?!1:D.ios&&!D.uc||4<=D.android&&D.mqq&&!D.isQQBrowserCss()||4<=D.android&&!D.mqq&&D.google&&!D.uc};(function(){if(D.i9300){var a=Math.sin,b=Math.cos;Math.sin=function(b){return b?a(b):0};Math.cos=function(a){return a?b(a):1}}})();m.prototype.add=function(a){return new m(this.x+a.x,this.y+a.y)};m.prototype.subtract=function(a){return new m(this.x-a.x,this.y-a.y)};m.prototype.dotProduct=function(a){return this.x*a.x+this.y*a.y};m.prototype.crossProduct=function(a){return this.x*a.y-this.y*a.x};m.prototype.length=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))};m.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};m.prototype.clone=function(){return new m(this.x,this.y)};m.prototype.normalize=function(a){var b=this.length();a?(this.x*=a,this.y*=a):b&&(this.x/=b,this.y/=b)};m.prototype.offset=function(a,b){this.x+=a;this.y+=b};m.prototype.toString=function(){return[this.x,this.y].join()};m.polar=function(a,b){return new m(a*Math.cos(b),a*Math.sin(b))};m.distance=function(a,b){return b.subtract(a).length()};m.interpolate=function(a,b,c){if(0==c)return b;if(1==c)return a;a=a.subtract(b);a.normalize(c);return a.add(b)};m.toString=function(){return"("+this.x+","+this.y+")"};var na=m;h(location.search&&location.search.substr(1));var gb=h(location.hash&&location.hash.substr(1)),X="https:"==window.location.protocol?"https://":"http://",ea={tileDomain:X+"sv${x}.map.qq.com/tile",thumbDomain:X+"http://sv1.map.qq.com/thumb",test_tileDomain:X+"test.sv${x}.map.qq.com/tile",test_thumbDomain:X+"test.sv1.map.qq.com/thumb",test_xmlDomain:X+"test.sv.map.qq.com",admin_tileDomain:X+"admin.sv${x}.map.qq.com/tile",admin_thumbDomain:X+"admin.sv1.map.qq.com/thumb",admin_xmlDomain:X+"admin.sv.map.qq.com",blank:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",streetTileDomain:X+"sv0.map.qq.com/road/",placeSearch:X+"apis.map.qq.com",placeSearchKey:"HGWBZ-A6SRV-TWHPL-UG2TZ-WSB2S-ZRFTQ",CDNPath:X+"s.map.qq.com/kepler/",uvStatUidKey:"QQMapKeplerUid4UV",poidetailPage:X+"mp.weixin.qq.com/mp/lifedetail?bid=dianping_{dpId}#wechat_redirect",poidetailList:X+"a.map.gtimg.com",statAPPName:"h5streetview"};if(window.__keplerDevConfig)for(var pa in __keplerDevConfig)ea[pa]=__keplerDevConfig[pa];ea.getImgUrl=function(a){return ea.CDNPath+a};ea.getResPath=function(a){return ea.CDNPath+a};var Ha={areaOfTriangle:x,pointInTriangle:S,intersectPlane:O,intersectTriangle:function(a,b,c,f,l){var e=f.x-c.x,d=f.y-c.y,T=f.z-c.z,n=l.x-c.x,E=l.y-c.y,I=l.z-c.z;return(a=O(a,b,c,{x:d*I-T*E,y:-(e*I-T*n),z:e*E-d*n}))&&S(a,c,f,l)?a:null}};p.prototype.clone=function(){return new p(this.x,this.y,this.z)};p.prototype.equals=function(a){return.001<=Math.abs(this.x-a.x)&&.001<=Math.abs(this.y-a.y)&&.001<=Math.abs(this.z-a.z)};p.prototype.add=function(a){return new p(this.x+a.x,this.y+a.y,this.z+a.z,0)};p.prototype.subtract=function(a){return new p(this.x-a.x,this.y-a.y,this.z-a.z,0)};p.prototype.dotProduct=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};p.prototype.crossProduct=function(a){var b=new p;b.x=this.y*a.z-this.z*a.y;b.y=this.z*a.x-this.x*a.z;b.z=this.x*a.y-this.y*a.x;b.w=1;return b};p.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};p.prototype.incrementBy=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z};p.prototype.project=function(){0!=this.w&&(this.x/=this.w,this.y/=this.w,this.z/=this.w,this.w=1)};p.prototype.normalize=function(){var a=this.length();0!=a&&(this.x/=a,this.y/=a,this.z/=a)};p.prototype.scaleBy=function(a){this.x*=a;this.y*=a;this.z*=a};p.prototype.toString=function(){return[this.x,this.y,this.z,this.w].join()};p.prototype.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};p.distance=function(a,b){};p.angleBetween=function(a,b){};var va="https:"==window.location.protocol?"https://":"http://",s={hashFilter:function(a){var b=/(\\?[^$]+)/i.test(a)?RegExp.$1:"";return a.replace(b,"").replace(/[?]?isappinstalled=\\d/i,"").replace(/[?]?from=[^&]+[&]?]/i,"")}};(function(){var a=Object.prototype,b=a.toString,c=a.hasOwnProperty;s.isArray=function(a){return"[object Array]"===b.call(a)};s.isNodeList=function(a){return"[object NodeList]"===b.call(a)};s.isObject=function(a){return"[object Object]"===b.call(a)};s.isNumber=function(a){return"[object Number]"===b.call(a)};var f=s.each=function(a,b){if(s.isArray(a)||s.isNodeList(a))for(var f=0,l=a.length;f<l;f++)b.call(a,a[f],f);else if(s.isObject(a))for(f in a)c.call(a,f)&&b.call(a,a[f],f);else if(s.isNumber(a))for(f=0,l=a;f<l;f++)b(f,a)},l={},e=/-(\\w)/g,d=function(a,b,c){return 0==c?b:b.toUpperCase()},T=function(a,b){var c=[];f(b,function(a,b){c.push(b+":"+a)});a.style.cssText=c.join(";")};s.createElem=function(a,b){var c=document.createElement(a);T(c,b,!0);return c};s.setStyles=function(a,b){f(b,function(b,c){var f=a.style,T;l[c]?T=l[c]:(T=c.replace(e,d),l[c]=T);f[T]=b})}})();s.toCoreHeading=function(a,b){a=parseFloat(a);if(!isNaN(a)&&!isNaN(parseFloat(b))){if(360<a||-360>a)a%=360;0>a&&(a=360+a);return a>=b?a-b:a+360-b}};s.toCorePitch=function(a){a=parseFloat(a);if(!isNaN(a))return a=Math.max(a,-90),Math.min(a,90)};s.getWorldPosition=function(a,b,c){a=a*Math.PI/180;b=b*Math.PI/180;b={x:Math.cos(b)*Math.sin(a),y:Math.sin(b),z:Math.cos(b)*Math.cos(a)};c/=2;c=[[{x:c,y:c,z:-c},{x:c,y:-c,z:-c},{x:-c,y:c,z:-c}],[{x:-c,y:-c,z:-c},{x:c,y:-c,z:-c},{x:-c,y:c,z:-c}],[{x:c,y:c,z:-c},{x:c,y:-c,z:-c},{x:c,y:c,z:c}],[{x:c,y:-c,z:-c},{x:c,y:-c,z:c},{x:c,y:c,z:c}],[{x:c,y:c,z:c},{x:c,y:-c,z:c},{x:-c,y:-c,z:c}],[{x:c,y:c,z:c},{x:-c,y:-c,z:c},{x:-c,y:c,z:c}],[{x:-c,y:c,z:c},{x:-c,y:c,z:-c},{x:-c,y:-c,z:-c}],[{x:-c,y:c,z:c},{x:-c,y:-c,z:c},{x:-c,y:-c,z:-c}],[{x:-c,y:c,z:-c},{x:c,y:c,z:-c},{x:c,y:c,z:c}],[{x:-c,y:c,z:-c},{x:-c,y:c,z:c},{x:c,y:c,z:c}],[{x:-c,y:-c,z:-c},{x:c,y:-c,z:-c},{x:c,y:-c,z:c}],[{x:-c,y:-c,z:-c},{x:-c,y:-c,z:c},{x:c,y:-c,z:c}]];for(a=0;a<c.length;a++){var f=c[a];if(f=Ha.intersectTriangle({x:0,y:0,z:0},b,f[0],f[1],f[2]))return new p(f.x,f.y,-f.z,1)}};(function(){window.__KeplerJsonpCbHolder={};var a=0;s.loadJsonp=function(b,c){var e="_"+a++,d=document.createElement("script");document.body.appendChild(d);d.src=b+"&output=jsonp&cb=__KeplerJsonpCbHolder."+e;window.__KeplerJsonpCbHolder[e]=function(a){c&&c(a);document.body.removeChild(d);delete window.__KeplerJsonpCbHolder[e];e=c=d=null}};var b,c;b={};s.getPanoInfo=function(a,c){if(b["s_"+a])setTimeout(function(){c(b["s_"+a])},0);else{var e=ea.uvStatUidKey,d=s.getCookie(e);d||(d=(new Date).getUTCMilliseconds(),d=Math.round(2147483647*Math.random())*d%1e10,document.cookie=e+"="+d+";path=/; expires=Sun, 18 Jan 2038 00:00:00 GMT;");e=ea.xmlDomain+"/sv?svid="+a+"&pf=html5&suid="+d;(d=gb.ref)&&(e+="&from="+d);(d=gb.ch||d)&&(e+="&ch="+d);s.loadJsonp(e,function(e){b["s_"+a]=e;c(e)})}};s.getXfPanoInfo=function(a,b,c,e,d){s.loadJsonp(va+"sv.map.qq.com/xf?x="+b+"&y="+c+"&r="+e+"&target=1&uid="+a,d)};c={};s.getAddress=function(a,b,e){c.lat==a&&c.lng==b?setTimeout(function(){e&&e(c.address)},0):s.loadJsonp(va+"sv.map.qq.com/rarp?lat="+a+"&lng="+b,function(d){0==d.info.errno&&(c={lat:a,lng:b,address:d.detail.AD},e&&e(d.detail.AD))})};s.getPoi3D=function(a,b,c,e,d){s.loadJsonp(va+"sv.map.qq.com/poi3d?x="+a+"&y="+b+"&source="+c+"&type="+e+"&output=jsonp",d)}})();(function(){function a(a,c){var f=new XMLHttpRequest;f.open("GET",a,!0);f.onload=function(){var a=JSON.parse(this.response);c(a);console.log("xhr:",this)};f.onerror=function(){console.error("xhr:",this);0==this.status&&console.error("\\u672a\\u627e\\u5230\\u670d\\u52a1\\uff01");c(null,"Net error")};f.send()}s.getPOIDetail=function(b,c,f,l){a(ea.poidetailList+"/poi/list/?x="+b+"&y="+c+"&type="+f,l)}})();s.getCookie=function(a){a=document.cookie.match(RegExp("(^| )"+a+"=([^;]*)(;|$)"));return null!=a?a[2]:null};s.report=function(a,b,c,f){c=document;var l=ea.uvStatUidKey;(f=s.getCookie(l))||(f=(new Date).getUTCMilliseconds(),f=Math.round(2147483647*Math.random())*f%1e10,c.cookie=l+"="+f+";path=/; expires=Sun, 18 Jan 2038 00:00:00 GMT;");var l=s.getCookie("session_id")||"",e=window.__pn||0,d=window.__resultPos||0,T=window.__tagId||0,n=[];a&&(n=a.split("_"),n[3]&&(a=n.slice(0,4).join("_")));var E=n[0]||"",g=n[1]||"",v=n[2]||"",ia=n[3]||"",r=n[4]||"",n=n[5]||"";(new Image(1,1)).src=va+"pr.map.qq.com/pingd?srctype=getsret&lurl="+escape(c.location)+"&ourl="+escape(a)+"&suid="+f+"&session_id="+l+"&search_id="+ia+"&unc="+n+"&keyword="+g+"&city="+v+"&ch="+b+"&sort="+E+"&subloc="+r+"&result_pos="+d+"&sc=map&pg="+e+"&tagId="+T+"&rand="+Math.random()};s.sudoReport=function(a,b,c,f){var l=new Image(1,1),e;3==arguments.length?e="?add="+a+"|"+b+"|"+(c||1):4==arguments.length&&(e="?add="+a+"|"+b+"|"+c+"|"+(f||1));l.src="//ping.map.qq.com/stat"+e};s.report3=function(a,b){var c=gb.ch||gb.ref||"",f=D.android?"android":D.ios?"ios":"",l;(l=(l=document.cookie.match(/suid=[^;]*/))&&0<l.length?l[0].split("=")[1]:null)||(l=(new Date).getUTCMilliseconds(),l=Math.round(2147483647*Math.random())*l%1e10,document.cookie="suid="+l+";path=/; expires=Sun, 18 Jan 2038 00:00:00 GMT;");(new Image(1,1)).src=va+"//pr.map.qq.com/pingd?appid="+a+"&suid="+l+"&logid="+b+"&rand="+Math.random()+"&app="+ea.statAPPName+"&ch="+c+"&pf="+f};s.getRandomID=function(a){var b=0;return function(){return"r_"+ ++b}}();s.report2=function(a){a=va+"isdspeed.qq.com/cgi-bin/r.cgi?flag1=7804&flag2=8&flag3=4&1="+a;(new Image(1,1)).src=a};(function(){s.lngFrom4326ToProjection=function(a){return 111319.49077777778*a};s.latFrom4326ToProjection=function(a){a=Math.log(Math.tan(.008726646259971648*(90+a)))/.017453292519943295;return 111319.49077777778*a};s.lngFromProjectionTo4326=function(a){return a/111319.49077777778};s.latFromProjectionTo4326=function(a){return 114.59155902616465*Math.atan(Math.exp(a/111319.49077777778*.017453292519943295))-90}})();s.getPOV=function(a,b,c,f,l){null==l&&(l=2.3);var e=l-2.3,d=new na(c-a,f-b);d.normalize();var n=new na(0,1);l=180*Math.acos(d.dotProduct(n))/Math.PI;0<n.crossProduct(d)&&(l=360-l);a=Math.sqrt(Math.pow(c-a,2)+Math.pow(f-b,2));a=180*Math.atan(e/a)/Math.PI;return{heading:l,pitch:a}};s.setOpacity=function(a,b){a.style.opacity=b/100};s.bindThis=function(a,b){return function(){a.apply(b,arguments)}};s.inherits=function(a,b){a.super_=b;a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})};s.textWidth=function(a){if(a.nodeType){var b=a.style.position||"static",c;a.style.left="-9999px";a.style.position="absolute";document.body.appendChild(a);c=a.offsetWidth;a.style.position=b;document.body.removeChild(a);return c}};var Ta="https:"==window.location.protocol?"https://":"http://",oa={defaultFovY:100,svDataUrl:Ta+"sv.map.qq.com",tileDomain:Ta+"sv${x}.map.qq.com/tile",thumbDomain:Ta+"sv1.map.qq.com/thumb",xmlDomain:Ta+"sv.map.qq.com",blank:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",logo:Ta+"s.map.qq.com/kepler/images/mapLogo3.png"},Ia=oa;t.prototype.setViewSize=function(a,b){this.img.style.width=a+"px";this.img.style.height=b+"px"};t.prototype.setPosition=function(a,b){this.img.style.left=a+"px";this.img.style.top=b+"px"};t.prototype.loadThumb=function(a,b){this.img.src==a?b(!0):(this.img.onload=function(){b()},this.img.src=a)};t.prototype.appendTo=function(a){a.appendChild(this.img)};t.prototype.setVisibility=function(a){this.img.style.display=a?"":"none"};t.prototype.setAlpha=function(a){s.setOpacity(this.img,a)};P.prototype.intersects=function(a){return this.x>a.x+a.width||this.x+this.width<a.x||this.y>a.y+a.height||this.y+this.height<a.y?!1:!0};P.prototype.contains=function(a){return a.x>=this.x&&a.x<=this.x+this.width&&a.y>=this.y&&a.y<=this.y+this.height};P.prototype.toString=function(){return"[x="+this.x+",y="+this.y+",width="+this.width+",height="+this.height+"]"};P.prototype.getClassName=function(){return"Rectangle"};var Ka=P,La=oa,db=C.TILE_WIDTH,eb=C.TILE_HEIGHT;Q.prototype.setViewSize=function(a,b){this.img.style.width=a+"px";this.img.style.height=b+"px"};Q.prototype.setPosition=function(a,b){var c=this.img.style;c.left=a+"px";c.top=b+"px";C.debug&&(this.img.style.border="1px solid",this.label.style.left=a+db/2+"px",this.label.style.top=b+eb/2+"px")};Q.prototype.loadTile=function(a,b){if(this.imgSrc!=a){var c=this.img;this.img.onload=function(){c.style.zIndex=3;b()};this.img.src=this.imgSrc=a}};Q.prototype.appendTo=function(a){a.appendChild(this.img);C.debug&&a.appendChild(this.label)};Q.prototype.getBounds=function(){return this.bounds};Q.prototype.setVisibility=function(a){this.visibility!=a&&(this.visibility=a,this.img.style.display=this.label.style.display=a?"":"none")};Q.prototype.isVisible=function(){return"none"!=this.img.style.display};Q.prototype.setAlpha=function(a){s.setOpacity(this.img,a)};J.prototype.addListener=function(a,b){if("function"!=typeof b)throw TypeError("Event Listener must be function");var c=this._listeners[a]||[];this._listeners[a]=c;c.push(b);c.length>this.maxListeners&&console.warn(a,"Listeners for ",this,"is",c.length,". May cause memory problem");return this};J.prototype.on=J.prototype.addListener;J.prototype.removeListener=function(a,b){var c=this._listeners[a]||[],f=c.indexOf(b);-1<f&&(c[f]=null)};J.prototype.dispatchEvent=function(a,b,c){c=c||this;var f=c._listeners[a];if(f)for(var l=0,e=f.length;l<e;l++)f[l]&&f[l].call(c,{type:a,data:b})};J.prototype.dispatchAsyncEvent=function(a,b){setTimeout(this.dispatchEvent,0,a,b,this)};J.prototype._cleanNullListeners=function(a,b){b=b||this;for(var c=b[a],f=[],l=0;l<c.length;l++)c[l]&&f.push(c[l]);b[a]=f};J.prototype.clearListeners=function(){this._listeners={}};var Ua=ca.prototype;Ua.append=function(a){this.pool.push(a)};Ua.remove=function(a){for(var b=0,c=-1;b<this.pool.length;b++)this.pool[b]==a&&(c=b);-1<c&&this.pool.splice(c,1)};Ua.bindEvent=function(a){a=a||this.canvas;for(var b=this;this.bindEvents[0];){var c=this.bindEvents.pop();a.addEventListener(c,function(a){return function(c){b.check(c,a)}}(c),!1)}};Ua.check=function(a,b){for(var c=this.pool.length-1;0<=c;c--){var f=this.pool[c];if(this.isInside(a,this.pool[c].eventPolygon)&&f.dispatchEvent){f.dispatchEvent(b,{evt:a});break}}};Ua.isInside=function(a,b){var c=!1,f,l;a.changedTouches?(l=a.changedTouches[0],window.webkitConvertPointFromPageToNode?(f=this.canvas,l=new WebKitPoint(l.pageX,l.pageY),l=webkitConvertPointFromPageToNode(f,l),f=l.x,l=l.y):(f=l.pageX,l=l.pageY)):(f=a.offsetX||a.pageX,l=a.offsetY||a.pageY);if(b){this.canvas.getContext("2d");for(var e=-1,d=b.length,n=d-1;++e<d;n=e)(b[e][1]<=l&&l<b[n][1]||b[n][1]<=l&&l<b[e][1])&&f<(b[n][0]-b[e][0])*(l-b[e][1])/(b[n][1]-b[e][1])+b[e][0]&&(c=!c)}return c};var sa,ma={getInstance:function(a,b){return sa||(sa=new ca(a,b))}};ga.prototype.equal=function(a){return this==a||.001>Math.abs(this.v[0]-a.v[0])&&.001>Math.abs(this.v[1]-a.v[1])&&.001>Math.abs(this.v[2]-a.v[2])&&.001>Math.abs(this.v[3]-a.v[3])};ga.prototype.dotProduct=function(a){return this.v[0]*a.v[0]+this.v[1]*a.v[1]+this.v[2]*a.v[2]+this.v[3]*a.v[3]};ga.prototype.identity=function(){this.v[0]=0;this.v[1]=0;this.v[2]=0;this.v[3]=1};ga.prototype.length=function(){var a=this.v[0],b=this.v[1],c=this.v[2],f=this.v[3];return Math.sqrt(a*a+b*b+c*c+f*f)};ga.prototype.toMatrix3D=function(){var a=[],b=this.v[0],c=this.v[1],f=this.v[2],l=this.v[3],e=b+b,d=c+c,n=f+f,g=b*e,E=b*d,b=b*n,I=c*d,c=c*n,f=f*n,e=l*e,d=l*d,l=l*n;a[0]=1-(I+f);a[1]=E+l;a[2]=b-d;a[3]=0;a[4]=E-l;a[5]=1-(g+f);a[6]=c+e;a[7]=0;a[8]=b+d;a[9]=c-e;a[10]=1-(g+I);a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};ga.prototype.toString=function(){return this.v.join(",")};e.prototype.clone=function(){for(var a=[],b=this.v.length-1;0<=b;b--)a[b]=this.v[b];return new e(a)};e.prototype.identity=function(){for(var a=0;16>a;a++)this.v[a]=0==a||5==a||10==a||15==a?1:0};e.prototype.equal=function(a){for(var b=0;16>b;b++)if(.01<=Math.abs(this.v[b]-a.v[b]))return!1;return!0};e.prototype.determinant=function(){var a=this.v[0],b=this.v[1],c=this.v[2],f=this.v[3],l=this.v[4],e=this.v[5],d=this.v[6],n=this.v[7],g=this.v[8],E=this.v[9],I=this.v[10],v=this.v[11],ia=this.v[12],r=this.v[13],k=this.v[14],m=this.v[15];return ia*E*d*f-g*r*d*f-ia*e*I*f+l*r*I*f+g*e*k*f-l*E*k*f-ia*E*c*n+g*r*c*n+ia*b*I*n-a*r*I*n-g*b*k*n+a*E*k*n+ia*e*c*v-l*r*c*v-ia*b*d*v+a*r*d*v+l*b*k*v-a*e*k*v-g*e*c*m+l*E*c*m+g*b*d*m-a*E*d*m-l*b*I*m+a*e*I*m};e.prototype.invert=function(){var a=this.v[0],b=this.v[1],c=this.v[2],f=this.v[3],l=this.v[4],e=this.v[5],d=this.v[6],n=this.v[7],g=this.v[8],E=this.v[9],I=this.v[10],v=this.v[11],r=this.v[12],k=this.v[13],m=this.v[14],h=this.v[15],w=a*e-b*l,z=a*d-c*l,q=a*n-f*l,Va=b*d-c*e,s=b*n-f*e,p=c*n-f*d,y=g*k-E*r,U=g*m-I*r,t=g*h-v*r,W=E*m-I*k,u=E*h-v*k,x=I*h-v*m,A=w*x-z*u+q*W+Va*t-s*U+p*y;A&&(this.v[0]=(e*x-d*u+n*W)/A,this.v[1]=(-b*x+c*u-f*W)/A,this.v[2]=(k*p-m*s+h*Va)/A,this.v[3]=(-E*p+I*s-v*Va)/A,this.v[4]=(-l*x+d*t-n*U)/A,this.v[5]=(a*x-c*t+f*U)/A,this.v[6]=(-r*p+m*q-h*z)/A,this.v[7]=(g*p-I*q+v*z)/A,this.v[8]=(l*u-e*t+n*y)/A,this.v[9]=(-a*u+b*t-f*y)/A,this.v[10]=(r*s-k*q+h*w)/A,this.v[11]=(-g*s+E*q-v*w)/A,this.v[12]=(-l*W+e*U-d*y)/A,this.v[13]=(a*W-b*U+c*y)/A,this.v[14]=(-r*Va+k*z-m*w)/A,this.v[15]=(g*Va-E*z+I*w)/A)};e.prototype.transpose=function(){var a=this.v[1],b=this.v[2],c=this.v[3],f=this.v[6],l=this.v[7],e=this.v[11];this.v[1]=this.v[4];this.v[2]=this.v[8];this.v[3]=this.v[12];this.v[4]=a;this.v[6]=this.v[9];this.v[7]=this.v[13];this.v[8]=b;this.v[9]=f;this.v[11]=this.v[14];this.v[12]=c;this.v[13]=l;this.v[14]=e};e.prototype.append=function(a){var b=a.v[0],c=a.v[1],f=a.v[2],l=a.v[3],e=a.v[4],d=a.v[5],n=a.v[6],g=a.v[7],E=a.v[8],r=a.v[9],v=a.v[10],k=a.v[11],m=a.v[12],h=a.v[13],q=a.v[14];a=a.v[15];var w=this.v[0],z=this.v[4],s=this.v[8],p=this.v[12];this.v[0]=w*b+z*c+s*f+p*l;this.v[4]=w*e+z*d+s*n+p*g;this.v[8]=w*E+z*r+s*v+p*k;this.v[12]=w*m+z*h+s*q+p*a;w=this.v[1];z=this.v[5];s=this.v[9];p=this.v[13];this.v[1]=w*b+z*c+s*f+p*l;this.v[5]=w*e+z*d+s*n+p*g;this.v[9]=w*E+z*r+s*v+p*k;this.v[13]=w*m+z*h+s*q+p*a;w=this.v[2];z=this.v[6];s=this.v[10];p=this.v[14];this.v[2]=w*b+z*c+s*f+p*l;this.v[6]=w*e+z*d+s*n+p*g;this.v[10]=w*E+z*r+s*v+p*k;this.v[14]=w*m+z*h+s*q+p*a;w=this.v[3];z=this.v[7];s=this.v[11];p=this.v[15];this.v[3]=w*b+z*c+s*f+p*l;this.v[7]=w*e+z*d+s*n+p*g;this.v[11]=w*E+z*r+s*v+p*k;this.v[15]=w*m+z*h+s*q+p*a};e.prototype.prepend=function(a){var b=a.v[0],c=a.v[1],f=a.v[2],l=a.v[3],e=a.v[4],d=a.v[5],n=a.v[6],g=a.v[7],r=a.v[8],k=a.v[9],v=a.v[10],m=a.v[11],h=a.v[12],s=a.v[13],p=a.v[14];a=a.v[15];var w=this.v[0],z=this.v[1],q=this.v[2],y=this.v[3];this.v[0]=b*w+e*z+r*q+h*y;this.v[1]=c*w+d*z+k*q+s*y;this.v[2]=f*w+n*z+v*q+p*y;this.v[3]=l*w+g*z+m*q+a*y;w=this.v[4];z=this.v[5];q=this.v[6];y=this.v[7];this.v[4]=b*w+e*z+r*q+h*y;this.v[5]=c*w+d*z+k*q+s*y;this.v[6]=f*w+n*z+v*q+p*y;this.v[7]=l*w+g*z+m*q+a*y;w=this.v[8];z=this.v[9];q=this.v[10];y=this.v[11];this.v[8]=b*w+e*z+r*q+h*y;this.v[9]=c*w+d*z+k*q+s*y;this.v[10]=f*w+n*z+v*q+p*y;this.v[11]=l*w+g*z+m*q+a*y;w=this.v[12];z=this.v[13];q=this.v[14];y=this.v[15];this.v[12]=b*w+e*z+r*q+h*y;this.v[13]=c*w+d*z+k*q+s*y;this.v[14]=f*w+n*z+v*q+p*y;this.v[15]=l*w+g*z+m*q+a*y};e.prototype.transformVector=function(a){var b=a.x,c=a.y;a=a.z;return new p(this.v[0]*b+this.v[4]*c+this.v[8]*a+this.v[12],this.v[1]*b+this.v[5]*c+this.v[9]*a+this.v[13],this.v[2]*b+this.v[6]*c+this.v[10]*a+this.v[14],this.v[3]*b+this.v[7]*c+this.v[11]*a+this.v[15])};e.prototype.transformVectors=function(a){for(var b=a.length,c=[],f=0;f<b;f++)c.push(this.transformVector(a[f]));return c};e.prototype.appendTranslate=function(a,b,c){var f,l,e,d,n,g,r,k,v,m,h,q;f=this.v[0];l=this.v[1];e=this.v[2];d=this.v[3];n=this.v[4];g=this.v[5];r=this.v[6];k=this.v[7];v=this.v[8];m=this.v[9];h=this.v[10];q=this.v[11];this.v[0]=f;this.v[1]=l;this.v[2]=e;this.v[3]=d;this.v[4]=n;this.v[5]=g;this.v[6]=r;this.v[7]=k;this.v[8]=v;this.v[9]=m;this.v[10]=h;this.v[11]=q;this.v[12]=f*a+n*b+v*c+this.v[12];this.v[13]=l*a+g*b+m*c+this.v[13];this.v[14]=e*a+r*b+h*c+this.v[14];this.v[15]=d*a+k*b+q*c+this.v[15]};e.prototype.appendScale=function(a,b,c){this.v[0]*=a;this.v[1]*=a;this.v[2]*=a;this.v[3]*=a;this.v[4]*=b;this.v[5]*=b;this.v[6]*=b;this.v[7]*=b;this.v[8]*=c;this.v[9]*=c;this.v[10]*=c;this.v[11]*=c};e.prototype.appendRotate=function(a,b){var c=Math.sin(a/2),f=c*b[0],l=c*b[1],c=c*b[2],d=Math.cos(a/2),f=(new ga([f,l,c,d])).toMatrix3D();this.append(new e(f))};e.prototype.interpolateTo=function(a,b){};e.interpolate=function(a,b,c){};e.prototype.toString=function(){return this.v.join(",")};e.prototype.glFrustum=function(a,b,c,f,l,e){var d=b-a,n=f-c,g=e-l;this.v[0]=2*l/d;this.v[1]=0;this.v[2]=0;this.v[3]=0;this.v[4]=0;this.v[5]=2*l/n;this.v[6]=0;this.v[7]=0;this.v[8]=(b+a)/d;this.v[9]=(f+c)/n;this.v[10]=-(e+l)/g;this.v[11]=-1;this.v[12]=0;this.v[13]=0;this.v[14]=-(e*l*2)/g;this.v[15]=0};e.prototype.glPerspective=function(a,b,c,f){a=c*Math.tan(a/2);var l=-a;this.glFrustum(l*b,a*b,l,a,c,f)};e.prototype.glLookAt=function(a,b,c){b=b.clone();b=b.subtract(a);b.normalize();b.w=0;c=c.clone();c=c.crossProduct(b);c.normalize();c.w=0;var f=b.clone(),f=f.crossProduct(c);f.w=0;var l=new p;l.x=c.dotProduct(a);l.y=f.dotProduct(a);l.z=b.dotProduct(a);l.w=1;this.v=[c.x,c.y,c.z,c.w,f.x,f.y,f.z,f.w,b.x,b.y,b.z,b.w,l.x,l.y,l.z,l.w]};e.prototype.glViewPort=function(a,b,c,f){this.v=[c/2,0,0,0,0,-f/2,0,0,0,0,1,0,c/2+a,f/2+b,0,1]};var Ra=e,ta=J;n.prototype=new ta;n.prototype.addEventWatch=function(){ma.getInstance().append(this)};n.prototype.removeEventWatch=function(){ma.getInstance().remove(this)};n.prototype.getModelMatrix=function(){return this._modelMatrix};n.prototype.setModelMatrix=function(a){this._modelMatrix=a};n.prototype.translate=function(a,b,c){this._modelMatrix.appendTranslate(a,b,c)};n.prototype.translateSelf=function(a,b,c){var f=new Ra;f.appendTranslate(a,b,c);this.vertices=f.transformVectors(this.vertices);this.eventCoords=f.transformVectors(this.eventCoords)};n.prototype.rotateSelf=function(a,b){var c=new Ra;c.appendRotate(a,b);this.vertices=c.transformVectors(this.vertices);this.eventCoords=c.transformVectors(this.eventCoords)};n.prototype.scaleSelf=function(a,b,c){var f=new Ra;f.appendScale(a,b,c);this.vertices=f.transformVectors(this.vertices);this.eventCoords=f.transformVectors(this.eventCoords)};n.prototype.scale=function(a,b,c){this._modelMatrix.appendScale(a,b,c)};n.prototype.rotate=function(a,b){this._modelMatrix.appendRotate(a,[b.x,b.y,b.z])};n.prototype.setTexture=function(a){this.texture.src=a};n.prototype.render=function(a){var b=a.canvas,c=a.camera,f=a.renderer,l=new Ra;l.append(c.viewMatrix);l.append(this.getModelMatrix());f.render(b,this.vertices,this.indices,this.uvtData,this.texture,c.projectMatrix,l,a,this)};var hb=function(a,b){a.super_=b;a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})},K=[],Pa=0,Lb=function(a){J.apply(this);this._i=++Pa;K[this._i]={key:this._key,real:a}};hb(Lb,J);var N=Lb.prototype;N.getHeading=function(){return K[this._i].real.getHeading()};N.setHeading=function(a){K[this._i].real.setHeading(a)};N.getPitch=function(){return K[this._i].real.getPitch()};N.setPitch=function(a){K[this._i].real.setPitch(a)};N.getPano=function(){return K[this._i].real.getSvid()};N.setPano=function(a){K[this._i].real.setSvid(a)};N.getPov=function(){var a=K[this._i].real.getHeading(),b=K[this._i].real.getPitch();return{heading:a,pitch:b}};N.setPov=function(a){if("object"!==typeof a||null===a||isNaN(a.heading)||isNaN(a.pitch))throw Error("Parameter is not valid. by:setPov()");var b=a.pitch;K[this._i].real.setHeading(a.heading);K[this._i].real.setPitch(b)};N.setZoom=function(a){K[this._i].real.setZoom(a)};N.getZoom=function(){return K[this._i].real.getZoom()};N.getVisible=function(){return K[this._i].real.getVisible()};N.setVisible=function(a){if("boolean"!==typeof a)throw Error("Parameter is not valid. by:setVisible()");K[this._i].real.setVisible(a)};N.getPosition=function(){return K[this._i].real.getPosition()};N._proxyOf=function(a){return K[this._i]===a};N.destroy=function(){K[this._i]=null};var N=null,wa=function(){this._container=this._pano=null};wa.prototype.addToPano=function(a){};wa.prototype.removefromPano=function(){};wa.prototype.getPano=function(){return this._pano};wa.prototype.getContainer=function(){if(null===this._container){var a=document.createElement("div");a.style.position="absolute";a.style.width=0;a.style.height=0;this._container=a;null!==this._pano&&K[this._pano._i]._panoContainer.appendChild(a)}return this._container};wa.prototype.NAME="PanoPlugin";D.ios||D.chrome||D.uc?r.prototype.preRender=function(){this._2dContext.clearRect(0,0,this.canvas.width,this.canvas.height)}:(console.warn("Fix android duplicate arrow bug."),r.prototype.preRender=function(){this._2dContext.clearRect(0,0,this.canvas.width,this.canvas.height);this.canvas.width+=1;this.canvas.width-=1});r.prototype.render=function(a,b,c,f,l,e,d,n,g){if(g.fixMatrix)for(l=g.fixMatrix,a=0,f=l.length;a<f;a++)d.prepend(l[a]);d.prepend(e);l=d.clone();f=[];e=[];var r=g.eventCoords||[];d=g.renderOptions||{};g.screenCoords=[];var k=b.length;a=0;for(var v;a<k;a++)v=l.transformVector(b[a]),v.project(),f.push(v);a=n.clip(f,c);if(0!=a.length){for(a=0;a<k;a++)v=f[a],v=n.viewPortMatrix.transformVector(v),e.push(v.x,v.y),g.screenCoords.push(v);b=[];a=0;for(f=r.length;a<f;a++)v=l.transformVector(r[a]),v.project(),v=n.viewPortMatrix.transformVector(v),b.push([v.x,v.y]);g.eventPolygon=b;n=this._2dContext;n.beginPath();n.strokeStyle=d.strokeStyle||"#000000";n.lineWidth="2";n.fillStyle=d.fillStyle||"#ffffff";b=e[0];c=e[1];n.moveTo(b,c);a=1;for(f=e.length/2-(g.extraVerticeNum||0);a<f;a++)b=e[2*a],c=e[2*a+1],n.lineTo(b,c);n.closePath();n.stroke();n.fill()}};var Fb=n,ib,za,Mb;y.prototype=new Fb;y.prototype.constructor=y;y.prototype.createLabel=function(){this.labelDom=document.createElement("div");var a=this.labelDom.style;a.position="absolute";a.top=0;a.left=0;a.whiteSpace="nowrap";a.fontSize="13px";a.visibility="hidden";a.zIndex=9};y.prototype.setLabel=function(a){this.labelDom.textContent=a};y.prototype._setLabelPos=function(a){var b=this.labelDom;a?(b.style.visibility="visible",b.style.webkitTransform="translate("+(a.x-b.offsetWidth/2)+"px, "+(a.y-b.offsetHeight/2)+"px)"):b.style.visibility="hidden"};y.prototype.build=function(){this.vertices[0]=new p(0,0,100);this.vertices[1]=new p(3,0,99);this.vertices[2]=new p(55,0,42);this.vertices[3]=new p(56,0,39);this.vertices[4]=new p(55,0,37);this.vertices[5]=new p(52,0,36);this.vertices[6]=new p(30,0,36);this.vertices[7]=new p(30,0,3);this.vertices[8]=new p(29,0,1);this.vertices[9]=new p(27,0,0);this.vertices[10]=new p(-27,0,0);this.vertices[11]=new p(-29,0,1);this.vertices[12]=new p(-30,0,3);this.vertices[13]=new p(-30,0,36);this.vertices[14]=new p(-52,0,36);this.vertices[15]=new p(-55,0,37);this.vertices[16]=new p(-56,0,39);this.vertices[17]=new p(-55,0,42);this.vertices[18]=new p(-3,0,99);this.labelVertexIndex=this.vertices.push(new p(0,0,51))-1;this.extraVerticeNum=1;this.eventCoords[0]=new p(60,0,0);this.eventCoords[1]=new p(60,0,100);this.eventCoords[2]=new p(-60,0,100);this.eventCoords[3]=new p(-60,0,0);this.indices[0]=0;this.indices[1]=1;this.indices[2]=2;this.indices[3]=2;this.indices[4]=3;this.indices[5]=4;this.indices[6]=2;this.indices[7]=4;this.indices[8]=5;this.indices[9]=5;this.indices[10]=6;this.indices[11]=0;this.indices[12]=0;this.indices[13]=2;this.indices[14]=5;this.scaleSelf(.01,1,.01);this.translateSelf(0,-4,.3)};y.prototype.render=function(a){var b=a.appParams;Mb=a;ib=b.heading;za=b.pitch;var b=this.getTranslatePos(3,50*Math.PI/180),c=new e;c.appendTranslate(b.x,b.y,b.z);this.setModelMatrix(c);b=15+15*Math.abs(Math.cos(ib*Math.PI/180));c=new e;c.appendTranslate(0,0,-3);c.appendRotate(b*Math.PI/180,[1,0,0]);c.appendTranslate(0,0,3);this.fixMatrix[0]=c;this._super.render.apply(this,arguments);this._setLabelPos(this.screenCoords[this.labelVertexIndex])};y.prototype.getTranslatePos=function(a,b){var c=za*Math.PI/180,f=Math.min(c,b),f=Math.max(c,-b),c=a*Math.cos(f)*Math.sin(-ib*Math.PI/180),l=a*Math.sin(f),f=a*Math.cos(f)*Math.cos(-ib*Math.PI/180);return new p(c,l,f)};y.prototype.reset=function(){(this.labelDom.parentNode||this.labelDom.parentElement)&&this.labelDom.parentNode.removeChild(this.labelDom);Mb&&Mb.removeObject3D(this)};y.prototype.removeListener=function(){this.clearListeners&&this.clearListeners();this.removeEventWatch&&this.removeEventWatch()};var Gb=n,Hb=10;W.prototype=new Gb;W.prototype.constructor=W;W.prototype.build=function(){for(var a=Hb,b=Hb,c=0,f=0,l=1/a,e=1/b,c=0;c<=a;c++)for(f=0;f<=b;f++)this.vertices.push(new p(l*c,0,e*f));for(c=0;c<a;c++)for(f=0;f<b;f++){var l=c*(b+1)+f,e=l+1,d=(c+1)*(b+1)+f,n=d+1;this.indices.push(l,e,d);this.indices.push(e,n,d)}for(c=0;c<this.vertices.length;c++)this.uvtData.push(this.vertices[c].x,this.vertices[c].z);this.translateSelf(0,-2,3)};W.prototype.render=function(a){this._super.render.apply(this,arguments)};var Aa=e;U.prototype.updateProjectMatrix=function(){this.projectMatrix.glPerspective(this.fovy,this.aspect,this.near,this.far)};U.prototype.lookAt=function(a,b,c){this.eye=a;this.target=b;this.up=c;this.viewMatrix.glLookAt(a,b,c)};U.prototype.lookAtTarget=function(a){this.target=a;this.viewMatrix.glLookAt(this.eye,a,this.up)};var Ba=e;A.prototype.setCamera=function(a){this.camera=a};A.prototype.setRenderer=function(a){this.renderer=a};A.prototype.addObject3D=function(a){this.world.push(a)};A.prototype.removeObject3D=function(a){for(var b=this.world.length,c=0;c<b;c++)if(this.world[c]==a){this.world.splice(c,1);break}};A.prototype.clear=function(){this.world=[]};A.prototype.render=function(){this.renderer.preRender();for(var a=this.world.length,b=0;b<a;b++)this.renderObject3D(this.world[b])};A.prototype.renderObject3D=function(a){a.render(this)};A.prototype.clip=function(a,b){for(var c=[],f=b.length/3,e=0;e<f;e++){var d=b[3*e],n=b[3*e+1],g=b[3*e+2],r=a[d],k=a[n],m=a[g],v=r.x,h=r.y,r=r.z,q=k.x,s=k.y,k=k.z,p=m.x,w=m.y,m=m.z;(-1<=v&&1>=v&&-1<=h&&1>=h&&0<=r&&1>=r||-1<=q&&1>=q&&-1<=s&&1>=s&&0<=k&&1>=k||-1<=p&&1>=p&&-1<=w&&1>=w&&0<=m&&1>=m)&&c.push(d,n,g)}return c};A.prototype.viewPort=function(a,b,c,f){this.viewPortMatrix=new Ba;this.viewPortMatrix.glViewPort(a,b,c,f);this.camera&&(this.camera.aspect=c/f,this.camera.updateProjectMatrix())};ha.prototype.addSubRectangle=function(a){this.subRects.push(a)};ha.prototype.getSubCount=function(){return this.subRects.length};ha.prototype.getSubRectangle=function(a){return a>=this.subRects?null:this.subRects[a]};ha.prototype.intersects=function(a){for(var b=0;b<this.subRects.length;b++)if(a.intersects(this.subRects[b]))return!0;return!1};ha.prototype.toString=function(){for(var a="[",b=0;b<this.subRects.length;b++)a=a+this.subRects[b].toString()+",";return a+"]"};ha.prototype.getClassName=function(){return"CompositeRectangle"};var Xa="0",xa={},Fa=60,jb=0,kb=null,Nb={init:function(){kb=window.setInterval(function(){Nb.run((new Date).getTime())},1e3/Fa)},run:function(a){var b,c;for(c in xa)b=xa[c],!0===b.handler(a-b.startTime)&&Nb.remove(c);0==jb&&(clearInterval(kb),kb=null)},add:function(a,b,c){1==arguments.length&&(b=a,a=void 0);a=a||"R_"+(new Date).getTime().toString(32)+ ++Xa;0==jb&&null===kb&&this.init();xa[a]||jb++;xa[a]={startTime:(new Date).getTime(),handler:b};return a},remove:function(a){xa[a]&&(delete xa[a],jb--)},getFPS:function(){},setMaxFPS:function(a){Fa=a}},Ob=Nb,Za=d,lb=C.COL_COUNT,Ja=C.ROW_COUNT,$a=C.TILE_WIDTH,ab=C.TILE_HEIGHT;V.prototype.refresh=function(){var a=this._pano.getSvid(),b=this;if(a){if(this._lastSvid&&this._lastSvid!=a){this._isSvidChanged=!0;var c=this._currentTiles;this._currentTiles=this._lastTiles;this._lastTiles=c;c=this._currentThumbs;this._currentThumbs=this._lastThumbs;this._lastThumbs=c;this._fadeAnimation.fadeOut(this._lastTiles);setTimeout(function(){b._fadeAnimation.fadeIn(b._currentTiles)},0);this._fadeAnimation.fadeOut(this._lastThumbs);setTimeout(function(){b._fadeAnimation.fadeIn(b._currentThumbs)},0)}this._paint(this._currentTiles,this._currentThumbs);this._lastSvid=a;this._isSvidChanged=!1}};V.prototype._paint=function(a,b){var c=this._pano.getSvid(),f=this._pano.getHeading(),e=this._pano.getPitch(),d=this._pano.getTileZoom(),n=this._pano.getBounds(),g=this._pano.getCompositeBounds(),r=this._pano.getCenter(),k=$a*d,m=ab*d;this._pano.isPreLoad();C.debug&&console.log("refresh heading="+f+" pitch="+e+" zoom="+d+" center="+r+" bounds="+n+" compositeBounds="+g);var f=this._getThumbURL(c),e=g.getSubCount(),r=this._getLoadTileCallback(e),n=g.getSubRectangle(0),v=-Math.floor(n.x*d),h=-Math.floor(n.y*d),q=b[0],s=b[1],p=C.TILES_WIDTH*d,w=C.TILES_HEIGHT*d;q.setPosition(v,h);q.loadThumb(f,r);q.setVisibility(!0);q.setViewSize(p,w);2==e?(v=n.width*d,s.setPosition(v,h),s.loadThumb(f,r),s.setVisibility(!0),s.setViewSize(p,w)):s.setVisibility(!1);f=0;v=[];for(e=0;e<lb;e++)for(r=0;r<Ja;r++)h=this._getTileIndex(e,r),h=a[h],q=this._isTileVisible(h,g),h.setVisibility(q),q&&(f++,v.push(h));r=this._getLoadTileCallback(f,"tile");g=0;for(e=v.length;g<e;g++)h=v[g],f=this._getTileURL(c,h.cidx,h.ridx),q=this._getTilePosition(h,n,d),h.loadTile(f,r),h.setViewSize(k,m),h.setPosition(q.x,q.y)};V.prototype._getLoadTileCallback=function(a,b){var c=this;if(!this._isSvidChanged)return function(){};var f=0,e,d;"tile"==b?(e="tileLoaded",d="tileLoading"):(e="thumbLoaded",d="thumbLoading");return function(){f++;f>=a&&c._pano.dispatchEvent(e);c._pano.dispatchEvent(d,{percent:f/a})}};V.prototype._isTileVisible=function(a,b){if(this._pano.isPreLoad())return!0;var c=a.getBounds();return b.intersects(c)};V.prototype._getTilePosition=function(a,b,c){var f=a.getBounds();a=f.x-b.x;b=f.y-b.y;a+C.TILE_WIDTH>C.TILES_WIDTH?a-=C.TILES_WIDTH:a<-C.TILE_WIDTH&&(a+=C.TILES_WIDTH);a=Math.floor(a*c);b=Math.floor(b*c);return new na(a,b)};V.prototype._createTiles=function(a){this._tiles=this._createTiles0(a,100);this._tiles2=this._createTiles0(a,0);this._currentTiles=this._tiles;this._lastTiles=this._tiles2};V.prototype._createThumbs=function(a){this._thumbs=this._createThumbs0(a,100);this._thumbs2=this._createThumbs0(a,0);this._currentThumbs=this._thumbs;this._lastThumbs=this._thumbs2};V.prototype._createThumbs0=function(a,b){for(var c=Array(2),f=0;2>f;f++){var e=new t;e.setAlpha(b);e.appendTo(a);c[f]=e}return c};V.prototype._createTiles0=function(a,b){for(var c=Array(lb),f=0;f<lb;f++)for(var e=0;e<Ja;e++){var d=new Q(f,e),n=this._getTileIndex(f,e);d.setAlpha(b);d.appendTo(a);c[n]=d}return c};V.prototype._getTileIndex=function(a,b){return a+b*lb};V.prototype._getTileURL=function(a,b,c){return this._getTileSite(b,c)+"?svid="+a+"&x="+b+"&y="+c+"&level=0&mtype=mobile"};V.prototype._getTileSite=function(a,b){return oa.tileDomain.replace("${x}",(a%3+b%3*3)%9)};V.prototype._getThumbURL=function(a){return oa.thumbDomain+"?svid="+a};var Na=function(){},bb=Object.prototype.toString,Oa={linear:function(a){return a},easeIn:function(a){return Math.pow(a,2)},easeOut:function(a){return Math.pow(a,.5)}},Pb=function(a,b){1==arguments.length&&"[object Function]"===bb.call(a)&&(b=a,a=void 0);a=a||{};this.playFunc=b;this.playID=null;this.FPS=this.progress=0;this._fpss={n:0,startTime:0};this.status=1;this.options={begin:void 0!==a.begin?a.begin:0,end:void 0!==a.end?a.end:100,duration:a.duration||1e3,times:a.times||1,timingFunction:a.timingFunction||Oa.linear,onBegin:a.onBegin||Na,onEnd:a.onEnd||Na,FPS:a.FPS||void 0}};Pb.extend=function(a,b){this.TIMING_FUNCTION[a]=b};Pb.TIMING_FUNCTION=Oa;var ya=Pb.prototype;ya.play=function(){this.playID&&3!==this.status&&this.stop();var a=this,b=this.options,c=this.progress,f=b.end-b.begin;b.onBegin(b.begin);var e=a.options.duration;this.status=2;this.playID=Ob.add(null,function(d,n){var g=c+d/e;if(1>g)a.progress=g,g=b.begin+f*b.timingFunction(g),a.playFunc(g);else if(Infinity===b.times||0<--b.times)a.progress=0,a.play();else return a.stop(),!0},b.FPS)};ya.addTimes=function(a){this.options.times+=a};ya.stop=function(){this.progress=0;Ob.remove(this.playID);this.playFunc(this.options.end);this.options.onEnd();this.playID=null;this.FPS=0;this.status=4};ya.pause=function(){this.status=3;Ob.remove(this.playID)};ya.getProgress=function(){return this.progress};ya.getLeftTimes=function(){return this.options.times};var Ib=n,ba=L.prototype=new Ib;ba.constructor=L;ba.clone=function(){var a=new this.constructor([]);a.vertices=this.vertices;a.indices=this.indices;return a};ba.build=function(a){this.vertices=a;this.indices[0]=0;this.indices[1]=1;this.indices[2]=2;this.indices[3]=0;this.indices[4]=2;this.indices[5]=3};ba.clip=function(a){var b=a.camera.projectMatrix,c=[],f,e;s.each(this.vertices,function(d,n){f=a.coreMatrix.transformVector(d);e=b.transformVector(f);e.project();c.push(e)});return 0==a.clip(c,this.indices).length?[]:c};ba.getScreenPosition=function(a,b){var c=[];s.each(b,function(b,e){var d;d=a.viewPortMatrix.transformVector(b);c.push({x:d.x,y:d.y})});return c};ba.canvasRender=function(a,b){var c=a.canvas.getContext("2d");c.beginPath();c.strokeStyle="#000000";c.lineWidth="1";c.fillStyle="rgba(0,0,0,0)";c.moveTo(b[0],b[1]);s.each(b,function(a,b){c.lineTo(a.x,a.y)});c.closePath();c.stroke();c.fill()};ba.tileRender=function(a,b){};ba.stopRender=function(){this._isStopRender=!0};ba.restoreRender=function(){this._isStopRender=!1};ba.render=function(a){if(!0!==this._isStopRender){var b=this.clip(a);0!=b.length&&(b=this.getScreenPosition(a,b),this.tileRender(a,b))}};ba.reset=function(a){a&&a.removeObject3D(this)};var Qa=function(){this._plugins=[]},Wa=Qa.prototype;Wa.dispatchEvent=function(a,b,c){J.prototype.dispatchEvent.apply(this,arguments);for(var f=0,e=this._plugins.length;f<e;f++)this._plugins[f].getPano().dispatchEvent(a,b,c)};Wa._createPanoProxy=function(){return new Lb(this)};Wa.addPlugin=function(a){if(!(a instanceof wa))throw Error("plugin not instanceof PanoPlugin");if(a.getPano())throw Error("plugin already added!");var b=this._createPanoProxy();a._pano=b;a._container&&this._panoContainer.appendChild(a._container);this._plugins.push(a);a.addToPano()};Wa.removePlugin=function(a){-1!==this._plugins.indexOf(a)&&(a.getPano().destroy(),a._pano=null,this._panoContainer.removeChild(a._container),a.removeFromPano())};var Wa=null,Vb=0,Wb="ongesturestart"in window,Xb=function(a){this.elem=a;this.supportEvents={};this.handlers={};this.touches=[];this.startDelta=void 0};Xb.prototype={on:function(a,b){var c="eid"+(new Date).getTime().toString(32)+ ++Vb;if(!this.hasEvent(a)){var f=this,e=function(b){"touchstart"==a&&f.addTouch(b.changedTouches);b.extendData=f.getTouchData(b.changedTouches);"touchend"==a&&f.delTouch(b.changedTouches);return f.fire(a,[b])};this.elem.addEventListener(a,e,!1);this.supportEvents[a]=e;this.handlers[a]={}}this.handlers[a][c]={handler:b};return c},off:function(a,b){if(this.hasEvent(a)){var c,f=this.handlers[a];for(c in f)if(c==b){delete f[c];break}this.hasEvent(a)||(this.elem.removeEventListener(a,this.supportEvents[a],!1),delete this.supportEvents[a],delete this.handlers[a]);if(!this.hasEvent())return this.destory(),null}},fire:function(a,b){if(this.hasEvent(a)){var c,f=this.handlers[a],e=[];for(c in f)!0===f[c].handler.apply(this.elem,b)&&e.push(c);for(;e.length;)this.off(a,e.pop())}},hasEvent:function(a){var b;if(0==arguments.length){for(b in this.handlers)if(b)return!0;return!1}if(!this.handlers[a])return!1;for(b in this.handlers[a])if(b)return!0;return!1},destory:function(){for(var a in this.supportEvents)this.elem.removeEventListener(a,this.supportEvents[a],!1);this.handlers=this.supportEvents=this.elem=null},addTouch:function(a){for(var b,c=0,f=a.length;c<f;c++)b=a[c],this.touches.push({id:b.identifier,pageX:b.pageX,pageY:b.pageY});2==this.touches.length&&(this.startDelta=R(this.touches[0],this.touches[1]))},delTouch:function(a){this.touches=[]},getTouchData:function(a){var b,c,f;(b=1<this.touches.length?!0:!1)?c=R(this.touches[0],this.touches[1]):this.touches[0]&&(f={x:a[0].pageX-this.touches[0].pageX,y:a[0].pageY-this.touches[0].pageY});return{isGesturing:b,startDelta:this.startDelta,delta:c,offset:f}}};var fa={},ja={isSupportEvent:function(a,b){b=b||document.createElement("div");a="on"+a;var c=a in b;b.setAttribute&&!c&&(b.setAttribute(a,"return;"),c="function"===typeof b[a]);return c},isSupportedGesturechange:Wb,on:function(a,b,c){var f=a.getAttribute("lKey"),e=fa[f];if(!e){var e=new Xb(a),d=f="eid"+(new Date).getTime().toString(32)+ ++Vb;fa[d]=e;a.setAttribute("lKey",d)}return{lKey:f,eName:b,eKey:e.on(b,c)}},off:function(a){for(a="[object Array]"===Object.prototype.toString.call(a)?a:[a];a.length;){var b=a.pop(),c=fa[b.lKey];c&&null===c.off(b.eName,b.eKey)&&delete fa[b.lKey]}},fire:function(a,b,c){(a=a.getAttribute("lKey"))&&fa[a]&&(c=c?c.unshift(void 0):[void 0],fa[a].fire(b,c))},clearAll:function(){for(var a in fa)fa[a].destory(),fa[a]=null;fa=null},drag:function(a,b,c,f){var e=this,d,n,g,r,k,m=!0;return this.on(a,"touchstart",function(v){d||(d=e.on(a,"touchmove",function(f){f.extendData.isGesturing||(r=f.changedTouches[0].pageX,k=f.changedTouches[0].pageY,m?(b&&b.apply(a,[f]),n={pageX:r,pageY:k,timeStamp:f.timeStamp},m=!1):2<R(n,f.changedTouches[0])&&(g={x:r-n.pageX,y:k-n.pageY,t:f.timeStamp-n.timeStamp},n={pageX:r,pageY:k,timeStamp:f.timeStamp},c.apply(a,[f,g])))}),e.on(a,"touchend",function(b){f&&f.apply(a,[b,b.extendData.offsetByPrev]);e.off(d);d=null;return m=!0}))})},dbclick:function(a,b){var c,f;return this.on(a,"touchstart",function(a){a.extendData.isGesturing||(f={pageX:a.touches[0].pageX,pageY:a.touches[0].pageY,time:(new Date).getTime()},c&&250>f.time-c.time&&20>R(f,c)?b&&b(a):c=f)})},clickHandlers:[],click:function(a,b){var c,f=null,e=-1<b.toString().indexOf(".stopPropagation()"),d=this.on(a,"touchstart",function(a){f?(clearTimeout(f),f=null,c=0,ja.clickHandlers=[]):a.extendData.isGesturing||(c=new Date,e&&a.stopPropagation())}),n=this.on(a,"touchend",function(d){if(!d.extendData.isGesturing&&d&&d.extendData&&d.extendData.offset){var n=d.extendData.offset.x,g=d.extendData.offset.y;400>n*n+g*g&&300>new Date-c&&(e&&d.stopPropagation(),ja.clickHandlers.push({handler:b,elem:a}),f||(f=setTimeout(function(){for(;ja.clickHandlers[0];){var a=ja.clickHandlers.shift();a.handler.apply(a.elem,[d])}f=null},249)))}});return[d,n]},stopNextClick:function(){ja.clickHandlers=[]},gesture:function(a,b,c,f){if(Wb){var e=[];b&&e.push(this.on(a,"gesturestart",b));c&&e.push(this.on(a,"gesturechange",c));f&&e.push(this.on(a,"gestureend",f));return e}}};window.onbeforeunload=function(){try{ja.clearAll(),ja=null}catch(a){}};var nb=ja;Y.prototype.CLICK_DURATION=130;Y.prototype.CLICK_INTERVAL=170;Y.prototype.CLICK_OFFSET=30;Y.prototype.handleEvent=function(a){a.stopPropagation();a.preventDefault();var b=a.targetTouches;switch(a.type){case"touchstart":if(1==b.length){b=b[0];if(!this._startTouch){this._startTouch={pageX:b.pageX,pageY:b.pageY,timeStamp:a.timeStamp};break}console.assert(!this._touch2,"\\u6e05\\u9664\\u7b2c\\u4e8c\\u6b21touchstart\\u5f02\\u5e38");if(a.timeStamp-this._startTouch.timeStamp>this.CLICK_DURATION+this.CLICK_INTERVAL){console.log("Second touch start tool long, stop dbclick.");break}var c=this._startTouch;if(Math.abs(b.pageX-c.pageX)>this.CLICK_OFFSET&&Math.abs(b.pageY-c.pageY)>this.CLICK_OFFSET){console.log("Second touch start too far, stop dbclick.");break}this._touch2={pageX:b.pageX,pageY:b.pageY,timeStamp:a.timeStamp}}else this._clickTimer&&(clearTimeout(this._clickTimer),this._clickTimer=null),this._touch2=this._startTouch=null,this._lastDragEvt&&this._dispatchDragEnd(a);break;case"touchmove":this._lastDragEvt?this._dispatchDrag(a):this._startTouch&&this._dispatchDragStart(a);this._clickTimer&&(clearTimeout(this._clickTimer),this._touch2=this._clickTimer=null);this._startTouch=null;break;case"touchend":case"touchcancel":b=this._startTouch;c=this._touch2;if(b)if(console.assert(!this._lastDragEvt,"startTouch not cleared when move."),c)a.timeStamp-c.timeStamp<=this.CLICK_DURATION&&!this._lastDragEvt&&(clearTimeout(this._clickTimer),this._clickTimer=null,this._dispatchDbClick(a));else{if(this._clickTimer){console.log("Click timer is set, cancel it.");clearTimeout(this._clickTimer);this._startTouch=this._clickTimer=null;break}a.timeStamp-b.timeStamp<=this.CLICK_DURATION?this._clickTimer=setTimeout(this._dispatchClick,this.CLICK_DURATION+this.CLICK_INTERVAL,a,this):(this._startTouch=null,console.log("Click canceled, hold too long:"+(a.timeStamp-b.timeStamp)+", which is greater than "+this.CLICK_DURATION))}else console.assert(!c,"No start touch but second touch for click");this._lastDragEvt&&this._dispatchDragEnd(a);break;default:console.warn("Unexpected event for PanoEventDetector",a)}};Y.prototype._dispatchClick=function(a,b){b=b||this;var c=b._startTouch;console.assert(c,"Dispatching click but no startTouch.");clearTimeout(b._clickTimer);b._clickTimer=null;b._startTouch=null;b._touch2=null;b._listener.onClick({type:"click",pageX:c.pageX,pageY:c.pageY,timeStamp:a.timeStamp})};Y.prototype._dispatchDbClick=function(a){var b=this._startTouch,c=this._touch2;a={type:"dbclick",pageX:(b.pageX+c.pageX)/2,pageY:(b.pageY+c.pageY)/2,timeStamp:a.timeStamp};this._touch2=this._startTouch=null;this._listener.onDbClick(a)};Y.prototype._dispatchDragStart=function(a){var b=a.changedTouches[0],c=this._startTouch;this._lastDragEvt=a={type:"dragstart",offsetX:b.pageX-c.pageX,offsetY:b.pageY-c.pageY,pageX:b.pageX,pageY:b.pageY,timeStamp:a.timeStamp};this._listener.onDragStart(a)};Y.prototype._dispatchDrag=function(a){var b=a.changedTouches[0],c=this._lastDragEvt;this._lastDragEvt=a={type:"drag",offsetX:b.pageX-c.pageX,offsetY:b.pageY-c.pageY,dt:a.timeStamp-c.timeStamp,pageX:b.pageX,pageY:b.pageY,timeStamp:a.timeStamp};this._listener.onDrag(a)};Y.prototype._dispatchDragEnd=function(a){a=this._lastDragEvt;this._lastDragEvt=null;a.type="dragend";a.offsetX=0;a.offsetY=0;this._listener.onDragEnd(a)};Y.prototype.enable=function(){this._panoDom.addEventListener("touchstart",this,!0);this._panoDom.addEventListener("touchmove",this,!0);this._panoDom.addEventListener("touchend",this,!0);this._panoDom.addEventListener("touchcancel",this,!0)};Y.prototype.disable=function(){this._panoDom.removeEventListener("touchstart",this,!0);this._panoDom.removeEventListener("touchmove",this,!0);this._panoDom.removeEventListener("touchend",this,!0);this._panoDom.removeEventListener("touchcancel",this,!0)};var ob=A,pb=U,Jb=p,qb=ma,rb=r;da.prototype.extendSupportEvent=function(a){this._eventAction.canvas.addEventListener(a,function(a){},!1)};da.prototype.syncLookup=function(){var a=this._scene3d.camera,b=new e;b.appendRotate(this._panorama.getPitch()*Math.PI/180,[1,0,0]);b.appendRotate(this._panorama.getHeading()*Math.PI/180,[0,1,0]);a.lookAtTarget(b.transformVector(this._initTarget));var b=this._panorama,c=new e,f=this._panorama.getCore();c.appendRotate(b.getPitch()*Math.PI/180,[1,0,0]);c.appendRotate(b._getCoreHeading()*Math.PI/180,[0,1,0]);this._scene3d.coreMatrix=c;b=f.getFov()*Math.PI/180;a.fovy!=b&&(a.fovy=b,a.updateProjectMatrix())};da.prototype.render=function(){var a=this._panorama,b=this._scene3d.appParams;b.heading=a.getHeading();b.pitch=a.getPitch();b.pano=a;this.syncLookup();this._scene3d.render()};da.prototype.getProjectionPosition=function(a,b){this.syncLookup();var c=this._panorama;c.getCore();var f=c.getFov(),e=this._scene3d.camera,c=c.getViewHeight(),f=.5/Math.tan(f*Math.PI/360)*c,f=s.getWorldPosition(a,b,2*f),f=this._scene3d.coreMatrix.transformVector(f),e=e.projectMatrix.transformVector(f);e.project();if(0!=this._scene3d.clip([e],[0,0,0]).length)return e=this._scene3d.viewPortMatrix.transformVector(e),{z:f.z,x:e.x,y:e.y}};da.prototype.setViewport=function(a,b){this._scene3d.viewPort(0,0,a,b);this._canvas.width=a;this._canvas.height=b;this.syncLookup();this.render()};da.prototype.setZoom=function(){};da.prototype.addObject3D=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._scene3d.addObject3D(a[b]);else this._scene3d.addObject3D(a)};da.prototype.getScene=function(){return this._scene3d};da.prototype.getCamera=function(){return this._scene3d.camera};var Yb=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){return setTimeout(a,1e3/35)},sb=C,Rb=J,tb=V;hb(B,Rb);B.prototype.isPreLoad=function(){return this._isPreLoad};B.prototype.setSvid=function(a){this._svid=a;this._render()};B.prototype._loadThumb=function(a){console.warn("Custom tile not implemented in dompano")};B.prototype.setViewPort=function(a,b){this._viewWidth=a;this._viewHeight=b;this._resetZoomFactor(this._zoom);this._render()};B.prototype.setHeading=function(a){this._heading=a;this._render()};B.prototype.setPitch=function(a){this._setPitchImpl(a);this._render()};B.prototype._setPitchImpl=function(a){var b=this._getMinPitch(),c=this._getMaxPitch();this._pitch=a;this._pitch=Math.max(b,this._pitch);this._pitch=Math.min(c,this._pitch)};B.prototype.setZoom=function(a){this._zoom=a;this._tileZoom=this._zoom*this._ZoomFactor;this._render()};B.prototype.getSvid=function(){return this._svid};B.prototype.getHeading=function(){return this._heading};B.prototype.getPitch=function(){return this._pitch};B.prototype.getZoom=function(){return this._zoom};B.prototype.getFov=function(){return this._fovy};B.prototype.getTileZoom=function(){return this._tileZoom};B.prototype.getCenter=function(){return this._getPositionImpl(this._heading,this._pitch,this._tileZoom)};B.prototype.getBounds=function(){var a=this.getCenter(),b=this._getTilesViewWidth(),c=this._getTilesViewHeight();return new P(a.x-b/2,a.y-c/2,b,c)};B.prototype.getCompositeBounds=function(){var a=this.getCenter(),b=this._getTilesViewWidth(),c=this._getTilesViewHeight(),f=a.x-b/2,a=a.y-c/2;if(0>f){var f=b+f,e=b-f,d=this._config.TILES_WIDTH-e,b=new P(0,a,f,c),c=new P(d,a,e,c),e=new ha;e.addSubRectangle(c);e.addSubRectangle(b)}else f+b>this._config.TILES_WIDTH?(e=this._config.TILES_WIDTH-f,b=new P(0,a,b-e,c),c=new P(f,a,e,c),e=new ha,e.addSubRectangle(c),e.addSubRectangle(b)):(e=new ha,c=new P(f,a,b,c),e.addSubRectangle(c));return e};B.prototype.setMinPitch=function(){};B.prototype.setMaxPitch=function(){};B.prototype.getProjectionPosition=function(a,b){for(var c=this._getPositionImpl(a,-b,this._tileZoom),e=this.getCompositeBounds(),d=e.getSubCount(),n,g=0;g<d;g++){var r=e.getSubRectangle(g);if(r.contains(c)){n=r;break}}if(null!=n)return 2==d?(e=e.getSubRectangle(0),e=n==e?n.x:-e.width):e=n.x,new na((c.x-e)*this._tileZoom,(c.y-n.y)*this._tileZoom)};B.prototype._getTilesViewWidth=function(){return this._viewWidth/this._tileZoom};B.prototype._getTilesViewHeight=function(){return this._viewHeight/this._tileZoom};B.prototype._getPositionImpl=function(a,b,c,e){e=e||this._config.BEGIN_HEADING;a=this._getValidRatio((a-e)/360);return new na(this._config.TILES_WIDTH*a,b/180*this._config.TILES_HEIGHT+this._config.TILES_HEIGHT/2)};B.prototype._getValidRatio=function(a){return 0>a?Math.ceil(-a)+a:1<a?a-Math.floor(a):a};B.prototype._render=function(){null==this._animationId&&(this._animationId=Yb(s.bindThis(this._doRender,this)))};B.prototype._doRender=function(){this._animationId=null;this._tileManager.refresh();this.dispatchEvent("refresh")};B.prototype._getMaxPitch=function(){var a=this._getViewPitchRange()/2;return this._bottomPitch-a};B.prototype._getMinPitch=function(){var a=this._getViewPitchRange()/2;return this._topPitch+a};B.prototype._getViewPitchRange=function(){return 180*(this._getTilesViewHeight()/this._config.TILES_HEIGHT)};B.prototype._resetZoomFactor=function(a){this._ZoomFactor=180*this._viewHeight/(this._fovy*this._config.TILES_HEIGHT);this._tileZoom=a*this._ZoomFactor;var b=this._tileZoom*this._config.TILE_WIDTH,b=Math.round(b);this._tileZoom=b/this._config.TILE_WIDTH;this._ZoomFactor=this._tileZoom/a};var Sb=J,M=s,ub=function(){return{isFirstLoadingTile:!0,_allowLoadTiles:!1,_tileImages:{},_tile3DOverlays:{},_tileData:{},_loadingCount:0,_loadedCount:0,setAllowLoadTiles:function(a){this._allowLoadTiles=a},add:function(a,b){this._tileData[a]={overlay3D:b};b.manager=this},resetAllImgLoadState:function(){for(var a in this._tileData)this._tileData[a].overlay3D.restoreRender()},getAllTile3D:function(){var a=[],b;for(b in this._tileData)a.push(this._tileData[b].overlay3D);return a},renderTile:function(a){a=this._tileData[a];this._allowLoadTiles&&a&&(this.isFirstLoadingTile&&(setTimeout(function(a){a.isFirstLoadingTile=!1},0,this),this._loadingCount++),a.overlay3D.stopRender(),a=a.overlay3D.texture,a.src=a.dataset.src)},tileLoaded:function(a){if(this._tileData[a]&&null!==this._loadingCount)return this._loadedCount++,a=this._loadedCount/this._loadingCount,1<=a?(this._loadedCount=this._loadingCount=null,1):a}}};hb(H,Sb);H.prototype.get3DOverlays=function(){return this._tileMgr.getAllTile3D()};H.prototype.getPerspective=function(){return.5/Math.tan(this._fovy*Math.PI/360)*this._viewHeight};H.prototype._prepareTileSrc=function(){for(var a=this.get3DOverlays(),b=a.length-1;0<=b;b--){var c=a[b].texture.dataset,e=c,d;d=this._svid;var n=c.x,c=c.y,g=this._level;if(d){var r=0==g?"cube":"mobile-cube";d=[oa.tileDomain.replace("${x}",(n+2*c)%8),"?svid="+d,"&x="+n,"&y="+(c||0),"&level="+("cube"==r?0:g-1),"&mtype="+r,"&from=web"].join("")}else d="";e.src=d}};H.prototype.setSvid=function(a){this._svid=a;this._loadThumb();this._prepareTileSrc()};H.prototype._buildTilesContainer=function(){var a=this.getPerspective();this._tileContainer=M.createElem("div",{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",overflow:"hidden","-webkit-perspective":a});this._containerDom.appendChild(this._tileContainer);this._tileLayer=M.createElem("div",{position:"absolute",width:"100%",height:"100%","-webkit-transform-style":"preserve-3d","-webkit-transform":"translateZ("+a+"px) rotateX(0deg) rotateY(0deg)","z-index":3});this._tileContainer.appendChild(this._tileLayer);for(var a=[],b=this._tileCount*this._tileWidth,c=0;6>c;c++){var e=M.createElem("div",{"-webkit-backface-visibility":"hidden",position:"absolute",width:b+"px",height:b+"px",left:(this._viewWidth-this._tileWidth*this._tileCount)/2+"px",top:(this._viewHeight-this._tileWidth*this._tileCount)/2+"px","-webkit-transform":Ca(this,c),overflow:"hidden"});a.push(e);var d=M.createElem("img",{position:"absolute",width:6*b+"px",height:b+"px",left:-c*b+"px"});this._thumbImgs.push(d);d.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7";for(var n=M.createElem("div",{position:"absolute",width:b+"px",height:b+"px"}),g=n,r=c,k=r*this._tileCount,m=this.getPerspective(),h=2*m,h=new L([M.getWorldPosition(-45,35,h),M.getWorldPosition(0,45,h),M.getWorldPosition(0,0,h),M.getWorldPosition(-45,0,h)]),v=0;v<this._tileCount;v++)for(var q=0;q<this._tileCount;q++){var s=k+q,p=M.createElem("img",{width:this._tileWidth+"px",height:this._tileWidth+"px","float":"left",top:v*this._tileWidth+"px",left:q*this._tileWidth+"px","z-index":2});p.ondragstart=la;p.onselectstart=la;p.onload=this._onTileImgLoaded;var y="i_"+s+"_"+v;p.dataset.x=s;p.dataset.y=v;p.style.transition="opacity 300ms ease-out";p.style.opacity=0;g.appendChild(p);var w=h.clone();w.texture=p;w.translateSelf(s%this._tileCount*m,-m*v,0);4>r?w.rotateSelf(-Math.PI/2*r,[0,1,0]):4==r?w.rotateSelf(Math.PI/2,[1,0,0]):w.rotateSelf(Math.PI/2,[-1,0,0]);w.imgID=y;w.tileRender=ua;this._tileMgr.add(y,w)}e.appendChild(d);e.appendChild(n);this._tileLayer.appendChild(e)}this._thumbImgs[0].onload=this._onThumbLoaded;this._cubeSideDivs=a};H.prototype.setPov=function(a,b){this._heading=a;this._pitch=b;this.render()};H.prototype.setHeading=function(a){this._heading=a;this.render()};H.prototype.setPitch=function(a){this._pitch=a;this.render()};H.prototype.getFovy=function(){return this._fovy};H.prototype.getFov=function(){return this._fovy};H.prototype.setFovy=function(a){this._fovy=a};H.prototype.setZoom=function(a){this.setFovy(this._baseFovy-20*(a-1));this.render();a=this.getPerspective();this._tileLayer.style.webkitTransform=this._tileLayer.style.webkitTransform.replace(/translateZ\\(([^\\)]+)\\)/,"translateZ("+a+"px)");D.android&&D.chrome||(this._tileContainer.style.webkitPerspective=a)};H.prototype.setViewPort=function(a,b){this._viewWidth=a;this._viewHeight=b;var c=this._tileCount,e=this.getPerspective();this._tileContainer.style.webkitPerspective=e;this._tileLayer.style.webkitTransform=this._tileLayer.style.webkitTransform.replace(/translateZ\\(([^\\)]+)\\)/,"translateZ("+e+"px)");M.setStyles(this._tileContainer,{width:a+"px",height:b+"px"});M.setStyles(this._tileLayer,{width:a+"px",height:b+"px"});for(e=this._cubeSideDivs.length-1;0<=e;e--)M.setStyles(this._cubeSideDivs[e],{left:(a-this._tileWidth*c)/2+"px",top:(b-this._tileWidth*c)/2+"px"});this.render()};H.prototype.render=function(){null===this._renderId&&(this._renderId=Yb(this._doRender))};H.prototype._doRender=function(){this._tileLayer.style.webkitTransform=this._tileLayer.style.webkitTransform.replace(/rotateX\\(([^\\)]+)\\)/,"rotateX("+ -this._pitch+"deg)").replace(/rotateY\\(([^\\)]+)\\)/,"rotateY("+this._heading+"deg)");this._renderId=null;this.dispatchEvent("refresh")};H.prototype._loadThumb=function(a){a&&this.setSvid(null);a=a||oa.thumbDomain+"?svid="+this._svid+"&x=0&y=0&from=html5&level=0&mtype=mobile-cube";for(var b=this._thumbImgs.length-1;0<=b;b--)this._thumbImgs[b].src=a};H.prototype._onThumbLoaded=function(){this._hideTiles();this.dispatchEvent("thumbLoaded");this._loadTiles()};H.prototype._hideTiles=function(){for(var a=this._cubeSideDivs.length-1;0<=a;a--)for(var b=this._cubeSideDivs[a].children[1].children,c=b.length-1;0<=c;c--)b[c].style.transition="",b[c].style.opacity=0};H.prototype._loadTiles=function(){this._tileMgr.setAllowLoadTiles(!1);this._tileMgr.resetAllImgLoadState();this._tileMgr.setAllowLoadTiles(!0);this.render()};var vb=H,wb=B,Tb=J,Kb=D,xb=da,yb=e,$=s,fb=oa,zb={create:function(){function a(){g=null;d.dispatchEvent("movestart")}function b(a){a=a.data;a={x:a.offsetX,y:a.offsetY,t:a.dt};var b=d.getHeading()-.25*a.x,c=d.getPitch()-.25*a.y;d.setPov({pitch:c,heading:b});g=a}function c(a,b){if(g){var c=g.x/g.t*r*.25,q=g.y/g.t*r*.25,p=Math.sqrt(c*c+q*q),s=1;p>m*k&&(s=m*k/p,p*=s,c*=s,q*=s);var y=p/m,U=c*c/(2*m);0>c&&(U=-U);var A=q*q/(2*m);0>q&&(A=-A);var t=Date.now(),W=d.getHeading(),u=d.getPitch(),x=h.Circ.easeOut;e();n=setInterval(function(){var a=Date.now()-t;if(a>y)e();else{var b=x(a,W,-U,y),a=x(a,u,-A,y);d.setPov({heading:b,pitch:a})}},100/60);g=null}}function e(){n&&(clearInterval(n),n=null,d.dispatchEvent("moveend"))}var d,n,g,r=1,k=1200,m=180/(k*k),h={Circ:{easeIn:function(a,b,c,e){return-c*(Math.sqrt(1-(a/=e)*a)-1)+b},easeOut:function(a,b,c,e){return c*Math.sqrt(1-(a=a/e-1)*a)+b},easeInOut:function(a,b,c,e){return 1>(a/=e/2)?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b}}};return{addToPano:function(n){d=n;n.on("touchstart",e);n.on("dragstart",a);n.on("drag",b);n.on("dragend",c)},removeFromPano:function(a){}}}},Ab={create:function(){function a(a){var b=r.getModel().detail.vpoints.filter(function(b,c,e){return b.svid==a});return 1==b.length?b[0].link:[]}function b(a,b){var c=b.filter(function(b,c,e){return 0!=b.points.filter(function(b,c,e){return b.svid==a}).length});return 1==c.length?c[0]:null}function c(c){if(!c||0==c.length)return[];var e=r.getSvid(),f=[];b(e,c).points.forEach(function(b,c,d){b.svid==e&&(d[c-1]?f.push(d[c-1]):f=f.concat(a(e)),1!=d.length&&(d[c+1]?f.push(d[c+1]):f=f.concat(a(e))))});return f}function e(a){return a.filter(function(a,b,c){return 1==a.connected})}function d(){k.reset();r.scene.render()}function n(a){var b=Math.PI;a+=b/8;a>=2*b&&(a-=2*b);a=parseInt(4*a/b);return"\\u5317 \\u4e1c\\u5317 \\u4e1c \\u4e1c\\u5357 \\u5357 \\u897f\\u5357 \\u897f \\u897f\\u5317".split(" ")[a]}function g(a){var b,c;a.forEach(function(a,e,f){function g(a){d();r.setSvid(s)}var m=k.getArrow(),h=r.getModel().detail.basic,q=a.x-h.x,h=a.y-h.y,h=Math.acos(h/Math.sqrt(q*q+h*h)),h=0>q?2*Math.PI-h:h;c||(c=h);m.labelDom.addEventListener("touchend",function(){d();r.setSvid(s)},!1);var q=n(h),p=Math.abs(h-b);p>Math.PI&&(p=Math.PI-p);p=Math.PI;c&&(p=Math.abs(h-c),p>Math.PI&&(p=Math.PI-p));e===f.length-1&&(m.setLabel(q),r.getControlLayer().appendChild(m.labelDom),b=h);m.rotateSelf(-h,[0,1,0]);r.scene.addObject3D(m);var s=a.svid,y=!1;m.addListener("touchstart",function(a){a.data.evt.stopPropagation();a.data.evt.preventDefault();y=!0;m.renderOptions={fillStyle:"#ccffff"};r.scene.render()});m.addListener("touchmove",function(a){y=!1;m.renderOptions={};r.scene.render()});m.addListener("touchend",function(a){y&&(y=null,g.apply(this,[a]),setTimeout(function(){nb.stopNextClick()},0))})});r.scene.render()}var r,k={inUse:[],getArrow:function(){var a=new y;this.inUse.push(a);return a},reset:function(){for(;this.inUse[0];){var a=this.inUse.pop();a.removeListener();a.reset()}}};return{addToPano:function(a){r=a;r.addListener("svid_changed",function(b){setTimeout(function(){a.scene.syncLookup();var b;b=r.getModel();var d=b.detail.roads;(b=d?c(d):(b=b.detail.points)?e(b):null)&&g(b)},500)});r.addListener("svid_changed",d)},removeFromPano:function(){}}}},Bb={create:function(){function a(a,b){var e=a.x-b.x,d=a.y-b.y;return Math.sqrt(e*e+d*d)}var b;return{addToPano:function(c){b=c;b.onadvance=function(c){a:{c=c.changedTouches[0];var e=b.getModel().detail.basic.type;if(-1!==["park","street"].indexOf(e)&&(c=b.screenPosToGeoPos(c.clientX,c.clientY))){for(var e=[],d=b.getModel().detail,n=d.roads||[],g=0;g<n.length;g++)e=e.concat(n[g].points);var e=e.concat(d.vpoints),e=e.concat(d.points||[]),d=Number.MAX_VALUE,r=null,n=null,g=b.getModel().detail.basic,r=a(c,g);if(5>r)c=void 0;else{for(r=e.length-1;0<=r;r--){var k=e[r];if(k.svid!==b.getSvid()){var m=a(c,k);a(g,k);var h=s.getPOV(g.x,g.y,k.x,k.y),h=Math.abs(b.getHeading()-h.heading)%180;m<d&&90>h&&(d=m,n=k)}}c=n}if(c){b.setSvid(c.svid);b.scene.setViewport(innerWidth,innerHeight);c=c.svid;break a}}c=void 0}return c}}}}},Ub=Qa,Sa=!1;hb(q,Tb);(function(a,b){for(var c in b.prototype)"constructor"!==c&&(a.prototype[c]=b.prototype[c])})(q,Ub);q.prototype.DEFAULT_MIN_PITCH=-90;q.prototype.DEFAULT_MAX_PITCH=5;q.prototype.MIN_ZOOM=1;q.prototype.MAX_ZOOM=4;q.prototype._initPanoListeners=function(){var a=this;this._panoCore.addListener("tileLoading",function(b){a.dispatchEvent("tile_loading",b.data)});var b=(new Date).getTime(),c=null;this._panoCore.addListener("tileLoaded",function(e){c||(c=a.addListener("click",function(){a.stopOverlayChanged||(a.isOverlayVisible=!a.isOverlayVisible,a.dispatchEvent("overlay_visible_changed",{isOverlayVisible:a.isOverlayVisible}))}));a.dispatchEvent("tile_loaded");$.report2((new Date).getTime()-b)});this._panoCore.addListener("refresh",function(b){a.dispatchEvent("render");a.scene.render()});this._panoCore.addListener("thumbLoaded",function(b){a.dispatchEvent("thumb_loaded")});this._eventDetector=new Y(this._sceneMask,this);this._sceneMask.addEventListener("touchstart",function(b){a.dispatchEvent("touchstart",b)},!1)};q.prototype.onClick=function(a){};q.prototype.onDbClick=function(a){};q.prototype.onDragStart=function(a){this.dispatchEvent(a.type,a)};q.prototype.onDrag=function(a){this.dispatchEvent(a.type,a)};q.prototype.onDragEnd=function(a){this.dispatchEvent(a.type,a)};q.prototype._buildContainer=function(){window.getComputedStyle(this._containerDom).position.match(/relative|absolute|fixed/)||(this._containerDom.style.position="relative");this._panoContainer=$.createElem("div",{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",overflow:"hidden"});Sa&&(this._panoContainer.className="pano-container");this._containerDom.appendChild(this._panoContainer);this._sceneContainer=$.createElem("div",{position:"absolute","z-index":-1,"pointer-events":"none",left:"0px",top:"0px",width:"100%",height:"100%"});Sa&&(this._sceneContainer.className="scene-container");this._panoContainer.appendChild(this._sceneContainer);this._canvas=$.createElem("canvas",{position:"absolute"});this._panoContainer.appendChild(this._canvas);if(this._options.hasLogo){var a=$.createElem("img",{position:"absolute",right:"2px",bottom:"0px"});a.src=fb.logo;a.width=73;a.height=20;this._panoContainer.appendChild(a)}this._sceneMask=$.createElem("div",{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%"});Sa&&(this._sceneMask.className="scene-mask event-layer");this._panoContainer.appendChild(this._sceneMask)};q.prototype.setThumb=function(a){this._panoCore._loadThumb(a)};q.prototype.addPlugin=function(a){a.addToPano(this)};q.prototype.getOverlayVisible=function(){return this.isOverlayVisible};q.prototype.setOverlayVisible=function(a){this.isOverlayVisible!==a&&(this.isOverlayVisible=a,this.dispatchEvent("overlay_visible_changed",{isOverlayVisible:this.isOverlayVisible}))};q.prototype.getModel=function(){return this._model};q.prototype.setSvid=function(a){if(!a||"string"!=typeof a)throw Error("Pano id must be string");a!=this._svid&&(this._svid=a,this._panoCore&&this._panoCore.setSvid(a),this.stopOverlayChanged=!0,this._loadPanoInfo())};q.prototype.getSvid=function(){return this._svid};q.prototype._loadPanoInfo=function(){var a=localStorage.getItem("suid");if(!a){var b=(new Date).getUTCMilliseconds(),a=Math.round(2147483647*Math.random())*b%1e10;localStorage.setItem("suid",a)}b=this._options;a=fb.svDataUrl+"/sv?pf="+b.pf+"&svid="+this._svid+"&suid="+a+"&from="+b.from+"&ch="+b.ch;b.key&&(a+="&key="+b.key);$.loadJsonp(a,this._onSvDataLoaded)};q.prototype._onSvDataLoaded=function(a){if(-1==a.info.error)console.error("Invalid panoranam id.",a),this.dispatchEvent("error",Error("Invalid panoranam id."));else{var b=a.detail.basic;this._svid!=b.svid?console.warn("Request svid and response svid not the same!"):(this._svid=b.svid,this._model=a,this.data.scenicId=b.scenic_id,this.data.geoPos.x=b.x,this.data.geoPos.y=b.y,this._minPitch=b.pitch_min||this.DEFAULT_MIN_PITCH,this._maxPitch=b.pitch_max||this.DEFAULT_MAX_PITCH,b=Number(b.dir),b!==this.data.cameraDir&&(this.data.cameraDir=b,Sa&&console.warn("Camera dir changed."),null===this._heading?this._heading=b:this._panoCore.setHeading(this._getCoreHeading())),this.stopOverlayChanged=!1,this.dispatchEvent("svid_changed",a))}};q.prototype.faceToPlace=function(a,b,c,e){var d=this;d.stopOverlayChanged=!0;$.getXfPanoInfo(a,b,c,e,function(a){d.stopOverlayChanged=!1;if(-1==a.info.error)console.error("\\u5438\\u9644\\u63a5\\u53e3\\u8fd4\\u56de\\u9519\\u8bef",a),d.dispatch("error","\\u5438\\u9644\\u63a5\\u53e3\\u8fd4\\u56de\\u9519\\u8bef");else{var e=d.data.geoPos,e=$.getPOV(e.x,e.y,b,c);d.setHeading(e.heading);d.setSvid(a.detail.svid)}})};q.prototype.addMarker=function(a,b,c,e){if(!this.getModel())return!1;var d=$.getRandomID();a={elem:c,heading:a,pitch:b,isVisibile:void 0==e?this.isOverlayVisible:e};this._avoidMarkers(a);this.markers.content[d]=a;this.markers.length++;return d};q.prototype._avoidMarkers=function(a){var b=this.markers.content,c=parseInt(a.elem.style.width||a.elem.clientWidth)+2,e=parseInt(a.elem.style.height||a.elem.clientHeight)+2,d=.5/Math.tan(this._baseFovy*Math.PI/360)*this.getViewHeight(),n=360*Math.atan(.5*c/d)/Math.PI,g=360*Math.atan(.5*e/d)/Math.PI,r,k,h;for(h in b)r=b[h],c=parseInt(r.elem.style.width||r.elem.clientWidth)+2,e=parseInt(r.elem.style.height||r.elem.clientHeight)+2,c=360*Math.atan(.5*c/d)/Math.PI,e=360*Math.atan(.5*e/d)/Math.PI,c=new P(r.heading,r.pitch,c,e),k=new P(a.heading,a.pitch,n,g),180<r.heading-a.heading?k.x+=360:-180>r.heading-a.heading&&(c.x+=360),k.intersects(c)&&(a.pitch=r.pitch+e)};q.prototype.getHeadingRangeByCenter=function(a){var b=this.getFov(),b=.5/Math.tan(b*Math.PI/360)*this.getViewHeight();return 360*Math.atan(.5*a/b)/Math.PI};q.prototype.getAllMarkers=function(){return this.markers.content};q.prototype.getMarker=function(a){return this.markers.content[a]};q.prototype.removeMarker=function(a){if(a&&this.markers.content[a]){var b=this.markers.content[a].elem;b.ontouchend=b.ontouchstart=null;b.parentNode.removeChild(b);delete this.markers.content[a];this.markers.length--}else if(!a)for(b in this.markers.content)this.removeMarker(b)};q.prototype.showMarker=function(a){this._refreshMarkers(a,!0,!0)};q.prototype.hideMarker=function(a){this._refreshMarkers(a,!1,!1,!1)};q.prototype.setIsForceRefresh=function(a){this.isForceRefresh=a};q.prototype.refreshMarkersPosition=function(a){if(!this.isForceRefresh&&!this.isOverlayVisible)return!1;this._refreshMarkers(a,!0,!0)};q.prototype._refreshMarkers=function(a,b,c,e){var d=this.markers,n=this,g,r,k;if(0==d.length)return!0;var h=function(a){if(a){var d=n._panoCore;if(b){var r=n._getCoreHeading(a.heading),l=a.pitch;if(g=d.getProjectionPosition?d.getProjectionPosition(r,l):n.scene.getProjectionPosition(r,l))a.elem.style.left=g.x+"px",a.elem.style.top=g.y+"px"}c&&void 0===e&&(g&&!1===a.isVisibile?(a.elem.style.display="block",a.isVisibile=!0):void 0===g&&!0==a.isVisibile&&(a.elem.style.display="none",a.isVisibile=!1));void 0!==e&&(!0===e&&!1==a.isVisibile?(a.elem.style.display="",a.isVisibile=!0):!0==a.isVisibile&&(a.elem.style.display="none",a.isVisibile=!1))}};if(a)for(r=0,k=a.length;r<k;r++)h(d.content[a[r]]);else for(r in d.content)h(d.content[r]);this.dispatchEvent("marker_refresh");return this};q.prototype.setPov=function(a,b){this.setHeading(a.heading);this.setPitch(a.pitch)};q.prototype.getPOIPos=function(a,b){var c=this._getCoreHeading(a),e=-b;return this._panoCore.getProjectionPosition?this._panoCore.getProjectionPosition(c,e):this.scene.getProjectionPosition(c,e)};q.prototype._getCoreHeading=function(a){return(a||this._heading)-this.data.cameraDir};q.prototype.setHeading=function(a){if(null!=a){a=Number(a);if(isNaN(a))throw TypeError("Heading must be number.");a%=360;0>a&&(a+=360);a!==this._heading&&(this._heading=a,this._panoCore&&this._panoCore.setHeading(this._getCoreHeading()))}};q.prototype.getHeading=function(){return this._heading};q.prototype.setPitch=function(a){if(null!=a){a=Number(a);if(isNaN(a))throw TypeError("Pitch must be number.");a%=360;0>a&&(a+=360);270<a?a-=360:180<a&&(a=180-a);a=Math.min(a,this._maxPitch);a=Math.max(this._minPitch,a);a!==this._pitch&&(this._pitch=a,this._panoCore&&this._panoCore.setPitch(a))}};q.prototype.getPitch=function(){return this._pitch};q.prototype.setZoom=function(a){if(null!=a){a=Number(a);if(isNaN(a))throw TypeError("Zoom must be number.");a=Math.max(Math.min(a,this.MAX_ZOOM),this.MIN_ZOOM);a!==this._zoom&&(this._zoom=a,this._panoCore&&this._panoCore.setZoom(a))}};q.prototype.getZoom=function(){return this._zoom};q.prototype.getCore=function(){return this._panoCore};q.prototype.getFov=function(){return this._panoCore.getFov()};q.prototype.getControlLayer=function(){var a=document.createElement("div");a.style.position="absolute";a.style.width=0;a.style.height=0;this._panoContainer.appendChild(a);return a};q.prototype.getViewWidth=function(){return this._viewWidth};q.prototype.getViewHeight=function(){return this._viewHeight};var mb=null;q.prototype.updateViewport=function(a,b){var c=this;a=a||this._containerDom.clientWidth;b=b||this._containerDom.clientHeight;if(a!=this._viewWidth||b!=this._viewHeight)this.stopOverlayChanged=!0,null!==mb&&clearTimeout(mb),mb=setTimeout(function(){c.stopOverlayChanged=!1;mb=null},200),this._viewWidth=a,this._viewHeight=b,this._panoCore.setViewPort(a,b),this.scene.setViewport(a,b),this.dispatchEvent("resize")};q.prototype.setViewPort=function(a,b){this.updateViewport(a,b)};q.prototype.addOverlay=function(a){this.scene.addObject3D(a)};q.prototype.screenPosToHeadingPitch=function(a,b){var c=this.scene.getScene().viewPortMatrix.clone();c.invert();var e=new p(a,b,1),e=c.transformVector(e),c=this.scene.getCamera().projectMatrix.clone();c.invert();e=c.transformVector(e);c=this.scene.getScene().coreMatrix.clone();c.invert();var e=c.transformVector(e),c=new na(0,-1),d=new na(e.x,e.z);d.normalize();c=180*Math.acos(c.dotProduct(d))/Math.PI;0>e.x&&(c=360-c);d=new p(e.x,0,e.z);d.normalize();var n=e.clone();n.normalize();d=180*Math.acos(n.dotProduct(d))/Math.PI;90<d&&(d=180-d);0>e.y&&(d=-d);return{heading:c,pitch:d}};q.prototype.screenPosToGeoPos=function(a,b){var c=this.screenPosToHeadingPitch(a,b);if(!(0<=c.pitch)){var e=c.heading+this.data.cameraDir,d=-2.3/Math.tan(c.pitch*Math.PI/180),n=d*Math.cos(e*Math.PI/180),d=d*Math.sin(e*Math.PI/180),g=this.getModel().detail.basic;return{x:g.x+d,y:g.y+n,h:0,heading:e,pitch:c.pitch}}};q.prototype.isMiniAlbum=function(){return this.data.scenicId?!0:!1};var Cb=s.lngFrom4326ToProjection,Db=s.latFrom4326ToProjection,Eb=s.getPOV,Zb=function(a,b){if("object"!==typeof b||null===b||!a)throw Error("parameter is not valid! by:Proxy");var c=b.container;"string"===typeof c&&(b.container=document.getElementById(c));if(!b.container||b.container.nodeType!==HTMLElement.prototype.ELEMENT_NODE)throw Error("options.container is not valid!");this.model=a;this.model._render=this;this.autoPlaytime=null;this._pendingLabels=[];this.labels={};this.labelsOpt={};this.isLoaded=!1;this._markerContainer=Ea();c=this._container=b.container;delete b.container;b.svid=b.pano;b.canMove=!b.disableMove;b.hasLogo=!b.disableLogo;this.pano=new q(c,b);var e=this;this.pano._panoContainer.appendChild(this._markerContainer);this.fireModelEvent("loaded");this.pano.addListener("svid_changed",ka(this._onSvidChanged,this));this.pano.addListener("render",ka(this._onRender,this));this.pano.addListener("error",ka(this._onError,this));this.pano.addListener("thumbLoaded",aa(this.fireModelEvent,this,"thumb_loaded"));this.pano.addListener("dragstart",aa(this.fireModelEvent,this,"dragstart"));this.pano.addListener("dragend",aa(this.fireModelEvent,this,"dragend"));this.pano.addListener("dragstart",function(){clearInterval(e.autoPlaytime)})},F=Zb.prototype;F.fireModelEvent=function(a,b,c){this.model.fireEvent(a,b,c)};F.updateViewport=function(){this.pano.updateViewport()};F._onSvidChanged=function(a){a=a.data.detail;a=a.basic;var b=a.svid;a={svid:b,x:a.x,y:a.y,mode:a.mode,sno:a.sno,source:a.source,photoTime:"20"+b.substr(8,2)+"."+b.substr(10,2),dir:Number(a.dir)};this._updateLabelPov();this.fireModelEvent("pano_changed",a);this.isLoaded=!0;var c=this._pendingLabels;this._pendingLabels=null;if(c)for(a=0,b=c.length;a<b;a++)this.addLabel(c[a]);c=this._pendingMarkers;this._pendingMarkers=null;if(c)for(a=0,b=c.length;a<b;a++)this.addMarker(c[a])};F._onRender=function(){var a=this.pano.getHeading(),b=this.pano.getPitch(),c=this.pano.getZoom();this.hpz&&this.hpz.h===a&&this.hpz.p===b||this.fireModelEvent("pov_changed",{heading:a,pitch:b});this.hpz&&this.hpz.zoom===c||this.fireModelEvent("zoom_changed",c);this.hpz={h:a,p:b,z:c}};F._onError=function(a){this.fireModelEvent("error",a.data)};F.removePano=function(){this.model=this.pano=null};F._getKey=function(a){return this["get"+a.slice(0,1).toUpperCase()+a.slice(1)]()};F.setPov=function(a){if(!a||isNaN(a.heading)||isNaN(a.pitch))throw Error("parameter is not valid! by:Proxy.setPov");var b=this.pano;b.setHeading(a.heading);b.setPitch(a.pitch)};F.getPov=function(){return{heading:this.pano.getHeading(),pitch:this.pano.getPitch()}};F.setPano=function(a){this.isLoaded=!1;this.pano.setSvid(a)};F.getPano=function(){return this.pano.getSvid()};F.setZoom=function(a){this.pano.setZoom(a)};F.getZoom=function(){return this.pano.getZoom()};F.onLabelEvent=function(a){this.fireModelEvent("labelEvent",a)};F.onMarkerEvent=function(a){this.fireModelEvent("markerEvent",a)};F.addMarker=function(a){if(!this.isLoaded)throw Error("pano is not loaded! by:addMarker()");if(!a.dom||!a.heading||!a.pitch)throw Error("parameter is not valid! by:addMarker()");var b=a.dom;b.id=a.id||b.id;b.addEventListener("touchstart",aa(this.onMarkerEvent,this,{id:a.id,type:"touchstart"}),!1);b.addEventListener("touchend",aa(this.onMarkerEvent,this,{id:a.id,type:"touchend"}),!1);b.addEventListener("touchcancel",aa(this.onMarkerEvent,this,{id:a.id,type:"touchcancel"}),!1);b.addEventListener("click",aa(this.onMarkerEvent,this,{id:a.id,type:"click"}),!1);this._markerContainer.appendChild(b);return this.pano.addMarker(a.heading,a.pitch,b)};F.removeMarker=function(a){if(!this.isLoaded)throw Error("pano is not loaded! by:removeMarker()");if(!a)throw Error("parameter is not valid! by:removeMarker()");return this.pano.removeMarker(a)};F.addLabel=function(a){if(!a||"object"!==typeof a||isNaN(a.altitude)||"boolean"!==typeof a.visible)throw Error("parameter is not valid! by:addLabel()");if(!a.position||"object"!==typeof a.position||isNaN(a.position.lat)||isNaN(a.position.lng))throw Error("position is not valid! by:addLabel()");if(this.labels[a.id])throw Error("label id is exist! by:addLabel()");var b=parseFloat(a.altitude),c=Cb(parseFloat(a.position.lng)),e=Db(parseFloat(a.position.lat)),d=this.pano.data.geoPos;this._pendingLabels?this._pendingLabels.push(a):(b=Eb(d.x,d.y,c,e,b),c=document.createElement("div"),c.style.backgroundColor="rgba(0,0,0,0.6)",c.style.position="absolute",c.textContent=a.content,c.style.whiteSpace="nowrap",c.style.color="rgba(255,255,255,1)",c.style.padding="2px",c.id=a.id,c.addEventListener("touchstart",aa(this.onLabelEvent,this,{id:a.id,type:"touchstart"}),!1),c.addEventListener("touchend",aa(this.onLabelEvent,this,{id:a.id,type:"touchend"}),!1),c.addEventListener("touchcancel",aa(this.onLabelEvent,this,{id:a.id,type:"touchcancel"}),!1),c.addEventListener("click",aa(this.onLabelEvent,this,{id:a.id,type:"click"}),!1),this._markerContainer.appendChild(c),b=this.pano.addMarker(b.heading,b.pitch,c,a.visible),this.labels[a.id]=b,this.labelsOpt[a.id]=a,this.pano.refreshMarkersPosition([b]))};F._updateLabelPov=function(){var a=[],b;for(b in this.labels){var c=this.labelsOpt[b];this.removeLabel(b);a.push(c)}for(b=a.length-1;0<=b;b--)this.addLabel(a[b])};F.removeLabel=function(a){this._pendingLabels?this._pendingLabels=this._pendingLabels.filter(function(b){return b.id!==a}):(this.pano.removeMarker(this.labels[a]),delete this.labels[a],delete this.labelsOpt[a])};F.setThumb=function(a){this.pano.setThumb(a.cube)};F.addPlugin=function(){};F.autoPlayStart=function(a){if(0==a)clearInterval(this.autoPlaytime);else{var b=this;clearInterval(this.autoPlaytime);a=a?16*a*Math.PI/180:1.44;this.autoPlaytime=setInterval(function(){var c=b.pano.getHeading()+a;b.pano.setPov({heading:c})},50)}};F.autoPlayStop=function(){clearInterval(this.autoPlaytime)};F.setKeyStatus=function(){};F.setVisible=function(a){this.pano._panoContainer.style.visibility=a?"visible":"hidden"};Ma.$setExports(Zb)');
